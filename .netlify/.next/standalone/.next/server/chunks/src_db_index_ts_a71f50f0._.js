module.exports=[79371,18899,75225,49129,18916,e=>{"use strict";let t,i;var s,n=e.i(98323);let r=Symbol.for("drizzle:entityKind");function a(e,t){if(!e||"object"!=typeof e)return!1;if(e instanceof t)return!0;if(!Object.prototype.hasOwnProperty.call(t,r))throw Error(`Class "${t.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let i=Object.getPrototypeOf(e).constructor;if(i)for(;i;){if(r in i&&i[r]===t[r])return!0;i=Object.getPrototypeOf(i)}return!1}Symbol.for("drizzle:hasOwnEntityKind");class o{static [r]="ConsoleLogWriter";write(e){console.log(e)}}class l{static [r]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new o}logQuery(e,t){let i=t.map(e=>{try{return JSON.stringify(e)}catch{return String(e)}}),s=i.length?` -- params: [${i.join(", ")}]`:"";this.writer.write(`Query: ${e}${s}`)}}class u{static [r]="NoopLogger";logQuery(){}}class c{static [r]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}}class h{constructor(e,t){this.table=e,this.config=t,this.name=t.name,this.keyAsName=t.keyAsName,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType,this.generated=t.generated,this.generatedIdentity=t.generatedIdentity}static [r]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return void 0!==this.config.generated&&"byDefault"!==this.config.generated.type}}class d{static [r]="ColumnBuilder";config;constructor(e,t,i){this.config={name:e,keyAsName:""===e,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:i,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){""===this.config.name&&(this.config.name=e)}}let f=Symbol.for("drizzle:Name");class g{static [r]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{let{name:t,columns:i,foreignColumns:s}=e();return{name:t,columns:i,foreignTable:s[0].table,foreignColumns:s}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=void 0===e?"no action":e,this}onDelete(e){return this._onDelete=void 0===e?"no action":e,this}build(e){return new m(e,this)}}class m{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static [r]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:i}=this.reference(),s=t.map(e=>e.name),n=i.map(e=>e.name),r=[this.table[f],...s,i[0].table[f],...n];return e??`${r.join("_")}_fk`}}function p(e,...t){return e(...t)}function y(e,t){return`${e[f]}_${t.join("_")}_unique`}class b{constructor(e,t){this.name=t,this.columns=e}static [r]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new S(e,this.columns,this.nullsNotDistinctConfig,this.name)}}class w{static [r]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new b(e,this.name)}}class S{constructor(e,t,i,s){this.table=e,this.columns=t,this.name=s??y(this.table,this.columns.map(e=>e.name)),this.nullsNotDistinct=i}static [r]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}}function v(e,t,i){for(let s=t;s<e.length;s++){let n=e[s];if("\\"===n){s++;continue}if('"'===n)return[e.slice(t,s).replace(/\\/g,""),s+1];if(!i&&(","===n||"}"===n))return[e.slice(t,s).replace(/\\/g,""),s]}return[e.slice(t).replace(/\\/g,""),e.length]}class N extends d{foreignKeyConfigs=[];static [r]="PgColumnBuilder";array(e){return new x(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:i,actions:s})=>p((i,s)=>{let n=new g(()=>({columns:[e],foreignColumns:[i()]}));return s.onUpdate&&n.onUpdate(s.onUpdate),s.onDelete&&n.onDelete(s.onDelete),n.build(t)},i,s))}buildExtraConfigColumn(e){return new P(e,this.config)}}class T extends h{constructor(e,t){t.uniqueName||(t.uniqueName=y(e,[t.name])),super(e,t),this.table=e}static [r]="PgColumn"}class P extends T{static [r]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}}class ${static [r]="IndexedColumn";constructor(e,t,i,s){this.name=e,this.keyAsName=t,this.type=i,this.indexConfig=s}name;keyAsName;type;indexConfig}class x extends N{static [r]="PgArrayBuilder";constructor(e,t,i){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=i}build(e){let t=this.config.baseBuilder.build(e);return new C(e,this.config,t)}}class C extends T{constructor(e,t,i,s){super(e,t),this.baseColumn=i,this.range=s,this.size=t.size}size;static [r]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${"number"==typeof this.size?this.size:""}]`}mapFromDriverValue(e){return"string"==typeof e&&(e=function(e){let[t]=function e(t,i=0){let s=[],n=i,r=!1;for(;n<t.length;){let a=t[n];if(","===a){(r||n===i)&&s.push(""),r=!0,n++;continue}if(r=!1,"\\"===a){n+=2;continue}if('"'===a){let[e,i]=v(t,n+1,!0);s.push(e),n=i;continue}if("}"===a)return[s,n+1];if("{"===a){let[i,r]=e(t,n+1);s.push(i),n=r;continue}let[o,l]=v(t,n,!1);s.push(o),n=l}return[s,n]}(e,1);return t}(e)),e.map(e=>this.baseColumn.mapFromDriverValue(e))}mapToDriverValue(e,t=!1){let i=e.map(e=>null===e?null:a(this.baseColumn,C)?this.baseColumn.mapToDriverValue(e,!0):this.baseColumn.mapToDriverValue(e));return t?i:function e(t){return`{${t.map(t=>Array.isArray(t)?e(t):"string"==typeof t?`"${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${t}`).join(",")}}`}(i)}}class q extends N{static [r]="PgEnumObjectColumnBuilder";constructor(e,t){super(e,"string","PgEnumObjectColumn"),this.config.enum=t}build(e){return new _(e,this.config)}}class _ extends T{static [r]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}}let Q=Symbol.for("drizzle:isPgEnum");class D extends N{static [r]="PgEnumColumnBuilder";constructor(e,t){super(e,"string","PgEnumColumn"),this.config.enum=t}build(e){return new j(e,this.config)}}class j extends T{static [r]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}}function B(e,t){var i;let s,n;return Array.isArray(t)?s=Object.assign(e=>new D(e??"",s),{enumName:e,enumValues:[...t],schema:void 0,[Q]:!0}):(i=void 0,n=Object.assign(e=>new q(e??"",n),{enumName:e,enumValues:Object.values(t),schema:i,[Q]:!0}))}class I{static [r]="Subquery";constructor(e,t,i,s=!1,n=[]){this._={brand:"Subquery",sql:e,selectedFields:t,alias:i,isWith:s,usedTables:n}}}class A extends I{static [r]="WithSubquery"}let O=(e,s)=>t?(i||(i=t.trace.getTracer("drizzle-orm","0.45.1")),p((t,i)=>i.startActiveSpan(e,e=>{try{return s(e)}catch(i){throw e.setStatus({code:t.SpanStatusCode.ERROR,message:i instanceof Error?i.message:"Unknown error"}),i}finally{e.end()}}),t,i)):s(),F=Symbol.for("drizzle:ViewBaseConfig"),L=Symbol.for("drizzle:Schema"),k=Symbol.for("drizzle:Columns"),z=Symbol.for("drizzle:ExtraConfigColumns"),V=Symbol.for("drizzle:OriginalName"),M=Symbol.for("drizzle:BaseName"),E=Symbol.for("drizzle:IsAlias"),R=Symbol.for("drizzle:ExtraConfigBuilder"),U=Symbol.for("drizzle:IsDrizzleTable");class J{static [r]="Table";static Symbol={Name:f,Schema:L,OriginalName:V,Columns:k,ExtraConfigColumns:z,BaseName:M,IsAlias:E,ExtraConfigBuilder:R};[f];[V];[L];[k];[z];[M];[E]=!1;[U]=!0;[R]=void 0;constructor(e,t,i){this[f]=this[V]=e,this[L]=t,this[M]=i}}function K(e){return`${e[L]??"public"}.${e[f]}`}class W{static [r]="FakePrimitiveParam"}function H(e){return null!=e&&"function"==typeof e.getSQL}class G{static [r]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new Y([this])}}class Y{constructor(e){for(const t of(this.queryChunks=e,e))if(a(t,J)){const e=t[J.Symbol.Schema];this.usedTables.push(void 0===e?t[J.Symbol.Name]:e+"."+t[J.Symbol.Name])}}static [r]="SQL";decoder=ee;shouldInlineParams=!1;usedTables=[];append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return O("drizzle.buildSQL",t=>{let i=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":i.sql,"drizzle.query.params":JSON.stringify(i.params)}),i})}buildQueryFromSourceParams(e,t){let i=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{casing:s,escapeName:n,escapeParam:r,prepareTyping:o,inlineParams:l,paramStartIndex:u}=i;var c=e.map(e=>{if(a(e,G))return{sql:e.value.join(""),params:[]};if(a(e,Z))return{sql:n(e.value),params:[]};if(void 0===e)return{sql:"",params:[]};if(Array.isArray(e)){let t=[new G("(")];for(let[i,s]of e.entries())t.push(s),i<e.length-1&&t.push(new G(", "));return t.push(new G(")")),this.buildQueryFromSourceParams(t,i)}if(a(e,Y))return this.buildQueryFromSourceParams(e.queryChunks,{...i,inlineParams:l||e.shouldInlineParams});if(a(e,J)){let t=e[J.Symbol.Schema],i=e[J.Symbol.Name];return{sql:void 0===t||e[E]?n(i):n(t)+"."+n(i),params:[]}}if(a(e,h)){let i=s.getColumnCasing(e);if("indexes"===t.invokeSource)return{sql:n(i),params:[]};let r=e.table[J.Symbol.Schema];return{sql:e.table[E]||void 0===r?n(e.table[J.Symbol.Name])+"."+n(i):n(r)+"."+n(e.table[J.Symbol.Name])+"."+n(i),params:[]}}if(a(e,eu)){let t=e[F].schema,i=e[F].name;return{sql:void 0===t||e[F].isAlias?n(i):n(t)+"."+n(i),params:[]}}if(a(e,ei)){if(a(e.value,ea))return{sql:r(u.value++,e),params:[e],typings:["none"]};let t=null===e.value?null:e.encoder.mapToDriverValue(e.value);if(a(t,Y))return this.buildQueryFromSourceParams([t],i);if(l)return{sql:this.mapInlineParam(t,i),params:[]};let s=["none"];return o&&(s=[o(e.encoder)]),{sql:r(u.value++,t),params:[t],typings:s}}return a(e,ea)?{sql:r(u.value++,e),params:[e],typings:["none"]}:a(e,Y.Aliased)&&void 0!==e.fieldAlias?{sql:n(e.fieldAlias),params:[]}:a(e,I)?e._.isWith?{sql:n(e._.alias),params:[]}:this.buildQueryFromSourceParams([new G("("),e._.sql,new G(") "),new Z(e._.alias)],i):e&&"function"==typeof e&&Q in e&&!0===e[Q]?e.schema?{sql:n(e.schema)+"."+n(e.enumName),params:[]}:{sql:n(e.enumName),params:[]}:H(e)?e.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([e.getSQL()],i):this.buildQueryFromSourceParams([new G("("),e.getSQL(),new G(")")],i):l?{sql:this.mapInlineParam(e,i),params:[]}:{sql:r(u.value++,e),params:[e],typings:["none"]}});let d={sql:"",params:[]};for(let e of c)d.sql+=e.sql,d.params.push(...e.params),e.typings?.length&&(d.typings||(d.typings=[]),d.typings.push(...e.typings));return d}mapInlineParam(e,{escapeString:t}){if(null===e)return"null";if("number"==typeof e||"boolean"==typeof e)return e.toString();if("string"==typeof e)return t(e);if("object"==typeof e){let i=e.toString();return"[object Object]"===i?t(JSON.stringify(e)):t(i)}throw Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return void 0===e?this:new Y.Aliased(this,e)}mapWith(e){return this.decoder="function"==typeof e?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}}class Z{constructor(e){this.value=e}static [r]="Name";brand;getSQL(){return new Y([this])}}function X(e){return"object"==typeof e&&null!==e&&"mapToDriverValue"in e&&"function"==typeof e.mapToDriverValue}let ee={mapFromDriverValue:e=>e},et={mapToDriverValue:e=>e};({...ee,...et});class ei{constructor(e,t=et){this.value=e,this.encoder=t}static [r]="Param";brand;getSQL(){return new Y([this])}}function es(e,...t){let i=[];for(let[s,n]of((t.length>0||e.length>0&&""!==e[0])&&i.push(new G(e[0])),t.entries()))i.push(n,new G(e[s+1]));return new Y(i)}(s=es||(es={})).empty=function(){return new Y([])},s.fromList=function(e){return new Y(e)},s.raw=function(e){return new Y([new G(e)])},s.join=function(e,t){let i=[];for(let[s,n]of e.entries())s>0&&void 0!==t&&i.push(t),i.push(n);return new Y(i)},s.identifier=function(e){return new Z(e)},s.placeholder=function(e){return new ea(e)},s.param=function(e,t){return new ei(e,t)};var en=Y||(Y={});class er{constructor(e,t){this.sql=e,this.fieldAlias=t}static [r]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new er(this.sql,this.fieldAlias)}}en.Aliased=er;class ea{constructor(e){this.name=e}static [r]="Placeholder";getSQL(){return new Y([this])}}function eo(e,t){return e.map(e=>{if(a(e,ea)){if(!(e.name in t))throw Error(`No value for placeholder "${e.name}" was provided`);return t[e.name]}if(a(e,ei)&&a(e.value,ea)){if(!(e.value.name in t))throw Error(`No value for placeholder "${e.value.name}" was provided`);return e.encoder.mapToDriverValue(t[e.value.name])}return e})}let el=Symbol.for("drizzle:IsDrizzleView");class eu{static [r]="View";[F];[el]=!0;constructor({name:e,schema:t,selectedFields:i,query:s}){this[F]={name:e,originalName:e,schema:t,selectedFields:i,query:s,isExisting:!s,isAlias:!1}}getSQL(){return new Y([this])}}h.prototype.getSQL=function(){return new Y([this])},J.prototype.getSQL=function(){return new Y([this])},I.prototype.getSQL=function(){return new Y([this])},e.s(["Param",()=>ei,"Placeholder",()=>ea,"SQL",()=>Y,"StringChunk",()=>G,"View",()=>eu,"fillPlaceholders",()=>eo,"isDriverValueEncoder",()=>X,"isSQLWrapper",()=>H,"sql",()=>es],18899);class ec{constructor(e){this.table=e}static [r]="ColumnAliasProxyHandler";get(e,t){return"table"===t?this.table:e[t]}}class eh{constructor(e,t){this.alias=e,this.replaceOriginalName=t}static [r]="TableAliasProxyHandler";get(e,t){if(t===J.Symbol.IsAlias)return!0;if(t===J.Symbol.Name||this.replaceOriginalName&&t===J.Symbol.OriginalName)return this.alias;if(t===F)return{...e[F],name:this.alias,isAlias:!0};if(t===J.Symbol.Columns){let t=e[J.Symbol.Columns];if(!t)return t;let i={};return Object.keys(t).map(s=>{i[s]=new Proxy(t[s],new ec(new Proxy(e,this)))}),i}let i=e[t];return a(i,h)?new Proxy(i,new ec(new Proxy(e,this))):i}}class ed{constructor(e){this.alias=e}static [r]="RelationTableAliasProxyHandler";get(e,t){return"sourceTable"===t?ef(e.sourceTable,this.alias):e[t]}}function ef(e,t){return new Proxy(e,new eh(t,!1))}function eg(e,t){return new Proxy(e,new ec(new Proxy(e.table,new eh(t,!1))))}function em(e,t){return new Y.Aliased(ep(e.sql,t),e.fieldAlias)}function ep(e,t){return es.join(e.queryChunks.map(e=>a(e,h)?eg(e,t):a(e,Y)?ep(e,t):a(e,Y.Aliased)?em(e,t):e))}class ey{static [r]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,t){if("_"===t)return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(t===F)return{...e[F],selectedFields:new Proxy(e[F].selectedFields,this)};if("symbol"==typeof t)return e[t];let i=(a(e,I)?e._.selectedFields:a(e,eu)?e[F].selectedFields:e)[t];if(a(i,Y.Aliased)){if("sql"===this.config.sqlAliasedBehavior&&!i.isSelectionField)return i.sql;let e=i.clone();return e.isSelectionField=!0,e}if(a(i,Y)){if("sql"===this.config.sqlBehavior)return i;throw Error(`You tried to reference "${t}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return a(i,h)?this.config.alias?new Proxy(i,new ec(new Proxy(i.table,new eh(this.config.alias,this.config.replaceOriginalName??!1)))):i:"object"!=typeof i||null===i?i:new Proxy(i,new ey(this.config))}}function eb(e,t){return Object.entries(e).reduce((e,[i,s])=>{if("string"!=typeof i)return e;let n=t?[...t,i]:[i];return a(s,h)||a(s,Y)||a(s,Y.Aliased)||a(s,I)?e.push({path:n,field:s}):a(s,J)?e.push(...eb(s[J.Symbol.Columns],n)):e.push(...eb(s,n)),e},[])}function ew(e,t){let i=Object.keys(e),s=Object.keys(t);if(i.length!==s.length)return!1;for(let[e,t]of i.entries())if(t!==s[e])return!1;return!0}function eS(e,t){let i=Object.entries(t).filter(([,e])=>void 0!==e).map(([t,i])=>a(i,Y)||a(i,h)?[t,i]:[t,new ei(i,e[J.Symbol.Columns][t])]);if(0===i.length)throw Error("No values to set");return Object.fromEntries(i)}function ev(e){return e[J.Symbol.Columns]}function eN(e){return a(e,I)?e._.alias:a(e,eu)?e[F].name:a(e,Y)?void 0:e[J.Symbol.IsAlias]?e[J.Symbol.Name]:e[J.Symbol.BaseName]}function eT(e,t){return{name:"string"==typeof e&&e.length>0?e:"",config:"object"==typeof e?e:t}}"u"<typeof TextDecoder||new TextDecoder;class eP extends N{static [r]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:t,...i}=e;this.config.generatedIdentity={type:"always",sequenceName:t,sequenceOptions:i}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:t,...i}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:t,sequenceOptions:i}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}class e$ extends eP{static [r]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new ex(e,this.config)}}class ex extends T{static [r]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return"number"==typeof e?e:Number(e)}}class eC extends eP{static [r]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new eq(e,this.config)}}class eq extends T{static [r]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}}function e_(e,t){let{name:i,config:s}=eT(e,t);return"number"===s.mode?new e$(i):new eC(i)}class eQ extends N{static [r]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new eD(e,this.config)}}class eD extends T{static [r]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return"number"==typeof e?e:Number(e)}}class ej extends N{static [r]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new eB(e,this.config)}}class eB extends T{static [r]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}}function eI(e,t){let{name:i,config:s}=eT(e,t);return"number"===s.mode?new eQ(i):new ej(i)}class eA extends N{static [r]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new eO(e,this.config)}}class eO extends T{static [r]="PgBoolean";getSQLType(){return"boolean"}}function eF(e){return new eA(e??"")}class eL extends N{static [r]="PgCharBuilder";constructor(e,t){super(e,"string","PgChar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new ek(e,this.config)}}class ek extends T{static [r]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"char":`char(${this.length})`}}function ez(e,t={}){let{name:i,config:s}=eT(e,t);return new eL(i,s)}class eV extends N{static [r]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new eM(e,this.config)}}class eM extends T{static [r]="PgCidr";getSQLType(){return"cidr"}}function eE(e){return new eV(e??"")}class eR extends N{static [r]="PgCustomColumnBuilder";constructor(e,t,i){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=t,this.config.customTypeParams=i}build(e){return new eU(e,this.config)}}class eU extends T{static [r]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,t){super(e,t),this.sqlName=t.customTypeParams.dataType(t.fieldConfig),this.mapTo=t.customTypeParams.toDriver,this.mapFrom=t.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return"function"==typeof this.mapFrom?this.mapFrom(e):e}mapToDriverValue(e){return"function"==typeof this.mapTo?this.mapTo(e):e}}function eJ(e){return(t,i)=>{let{name:s,config:n}=eT(t,i);return new eR(s,n,e)}}class eK extends N{static [r]="PgDateColumnBaseBuilder";defaultNow(){return this.default(es`now()`)}}class eW extends eK{static [r]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new eH(e,this.config)}}class eH extends T{static [r]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return"string"==typeof e?new Date(e):e}mapToDriverValue(e){return e.toISOString()}}class eG extends eK{static [r]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new eY(e,this.config)}}class eY extends T{static [r]="PgDateString";getSQLType(){return"date"}mapFromDriverValue(e){return"string"==typeof e?e:e.toISOString().slice(0,-14)}}function eZ(e,t){let{name:i,config:s}=eT(e,t);return s?.mode==="date"?new eW(i):new eG(i)}class eX extends N{static [r]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new e0(e,this.config)}}class e0 extends T{static [r]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return"string"==typeof e?Number.parseFloat(e):e}}function e1(e){return new eX(e??"")}class e2 extends N{static [r]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new e8(e,this.config)}}class e8 extends T{static [r]="PgInet";getSQLType(){return"inet"}}function e5(e){return new e2(e??"")}class e9 extends eP{static [r]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new e6(e,this.config)}}class e6 extends T{static [r]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return"string"==typeof e?Number.parseInt(e):e}}function e3(e){return new e9(e??"")}class e4 extends N{static [r]="PgIntervalBuilder";constructor(e,t){super(e,"string","PgInterval"),this.config.intervalConfig=t}build(e){return new e7(e,this.config)}}class e7 extends T{static [r]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",t=this.precision?`(${this.precision})`:"";return`interval${e}${t}`}}function te(e,t={}){let{name:i,config:s}=eT(e,t);return new e4(i,s)}class tt extends N{static [r]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new ti(e,this.config)}}class ti extends T{static [r]="PgJson";constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if("string"==typeof e)try{return JSON.parse(e)}catch{}return e}}function ts(e){return new tt(e??"")}class tn extends N{static [r]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new tr(e,this.config)}}class tr extends T{static [r]="PgJsonb";constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if("string"==typeof e)try{return JSON.parse(e)}catch{}return e}}function ta(e){return new tn(e??"")}class to extends N{static [r]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new tl(e,this.config)}}class tl extends T{static [r]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[t,i,s]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(i),Number.parseFloat(s)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}}class tu extends N{static [r]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new tc(e,this.config)}}class tc extends T{static [r]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[t,i,s]=e.slice(1,-1).split(",");return{a:Number.parseFloat(t),b:Number.parseFloat(i),c:Number.parseFloat(s)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}}function th(e,t){let{name:i,config:s}=eT(e,t);return s?.mode&&"tuple"!==s.mode?new tu(i):new to(i)}class td extends N{static [r]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new tf(e,this.config)}}class tf extends T{static [r]="PgMacaddr";getSQLType(){return"macaddr"}}function tg(e){return new td(e??"")}class tm extends N{static [r]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new tp(e,this.config)}}class tp extends T{static [r]="PgMacaddr8";getSQLType(){return"macaddr8"}}function ty(e){return new tm(e??"")}class tb extends N{static [r]="PgNumericBuilder";constructor(e,t,i){super(e,"string","PgNumeric"),this.config.precision=t,this.config.scale=i}build(e){return new tw(e,this.config)}}class tw extends T{static [r]="PgNumeric";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue(e){return"string"==typeof e?e:String(e)}getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class tS extends N{static [r]="PgNumericNumberBuilder";constructor(e,t,i){super(e,"number","PgNumericNumber"),this.config.precision=t,this.config.scale=i}build(e){return new tv(e,this.config)}}class tv extends T{static [r]="PgNumericNumber";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue(e){return"number"==typeof e?e:Number(e)}mapToDriverValue=String;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class tN extends N{static [r]="PgNumericBigIntBuilder";constructor(e,t,i){super(e,"bigint","PgNumericBigInt"),this.config.precision=t,this.config.scale=i}build(e){return new tT(e,this.config)}}class tT extends T{static [r]="PgNumericBigInt";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}function tP(e,t){let{name:i,config:s}=eT(e,t),n=s?.mode;return"number"===n?new tS(i,s?.precision,s?.scale):"bigint"===n?new tN(i,s?.precision,s?.scale):new tb(i,s?.precision,s?.scale)}class t$ extends N{static [r]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new tx(e,this.config)}}class tx extends T{static [r]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if("string"==typeof e){let[t,i]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(i)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}}class tC extends N{static [r]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new tq(e,this.config)}}class tq extends T{static [r]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if("string"==typeof e){let[t,i]=e.slice(1,-1).split(",");return{x:Number.parseFloat(t),y:Number.parseFloat(i)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}}function t_(e,t){let{name:i,config:s}=eT(e,t);return s?.mode&&"tuple"!==s.mode?new tC(i):new t$(i)}function tQ(e,t){let i=new DataView(new ArrayBuffer(8));for(let s=0;s<8;s++)i.setUint8(s,e[t+s]);return i.getFloat64(0,!0)}function tD(e){let t=function(e){let t=[];for(let i=0;i<e.length;i+=2)t.push(Number.parseInt(e.slice(i,i+2),16));return new Uint8Array(t)}(e),i=0,s=t[0];i+=1;let n=new DataView(t.buffer),r=n.getUint32(i,1===s);if(i+=4,0x20000000&r&&(n.getUint32(i,1===s),i+=4),(65535&r)==1){let e=tQ(t,i),s=tQ(t,i+=8);return i+=8,[e,s]}throw Error("Unsupported geometry type")}class tj extends N{static [r]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new tB(e,this.config)}}class tB extends T{static [r]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return tD(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}}class tI extends N{static [r]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new tA(e,this.config)}}class tA extends T{static [r]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let t=tD(e);return{x:t[0],y:t[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}}function tO(e,t){let{name:i,config:s}=eT(e,t);return s?.mode&&"tuple"!==s.mode?new tI(i):new tj(i)}class tF extends N{static [r]="PgRealBuilder";constructor(e,t){super(e,"number","PgReal"),this.config.length=t}build(e){return new tL(e,this.config)}}class tL extends T{static [r]="PgReal";constructor(e,t){super(e,t)}getSQLType(){return"real"}mapFromDriverValue=e=>"string"==typeof e?Number.parseFloat(e):e}function tk(e){return new tF(e??"")}class tz extends N{static [r]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new tV(e,this.config)}}class tV extends T{static [r]="PgSerial";getSQLType(){return"serial"}}function tM(e){return new tz(e??"")}class tE extends eP{static [r]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new tR(e,this.config)}}class tR extends T{static [r]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>"string"==typeof e?Number(e):e}function tU(e){return new tE(e??"")}class tJ extends N{static [r]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new tK(e,this.config)}}class tK extends T{static [r]="PgSmallSerial";getSQLType(){return"smallserial"}}function tW(e){return new tJ(e??"")}class tH extends N{static [r]="PgTextBuilder";constructor(e,t){super(e,"string","PgText"),this.config.enumValues=t.enum}build(e){return new tG(e,this.config)}}class tG extends T{static [r]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}}function tY(e,t={}){let{name:i,config:s}=eT(e,t);return new tH(i,s)}class tZ extends eK{constructor(e,t,i){super(e,"string","PgTime"),this.withTimezone=t,this.precision=i,this.config.withTimezone=t,this.config.precision=i}static [r]="PgTimeBuilder";build(e){return new tX(e,this.config)}}class tX extends T{static [r]="PgTime";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){let e=void 0===this.precision?"":`(${this.precision})`;return`time${e}${this.withTimezone?" with time zone":""}`}}function t0(e,t={}){let{name:i,config:s}=eT(e,t);return new tZ(i,s.withTimezone??!1,s.precision)}class t1 extends eK{static [r]="PgTimestampBuilder";constructor(e,t,i){super(e,"date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=i}build(e){return new t2(e,this.config)}}class t2 extends T{static [r]="PgTimestamp";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){let e=void 0===this.precision?"":` (${this.precision})`;return`timestamp${e}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(e){return"string"==typeof e?new Date(this.withTimezone?e:e+"+0000"):e}mapToDriverValue=e=>e.toISOString()}class t8 extends eK{static [r]="PgTimestampStringBuilder";constructor(e,t,i){super(e,"string","PgTimestampString"),this.config.withTimezone=t,this.config.precision=i}build(e){return new t5(e,this.config)}}class t5 extends T{static [r]="PgTimestampString";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){let e=void 0===this.precision?"":`(${this.precision})`;return`timestamp${e}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(e){if("string"==typeof e)return e;let t=e.toISOString().slice(0,-1).replace("T"," ");if(this.withTimezone){let i=e.getTimezoneOffset();return`${t}${i<=0?"+":"-"}${Math.floor(Math.abs(i)/60).toString().padStart(2,"0")}`}return t}}function t9(e,t={}){let{name:i,config:s}=eT(e,t);return s?.mode==="string"?new t8(i,s.withTimezone??!1,s.precision):new t1(i,s?.withTimezone??!1,s?.precision)}class t6 extends N{static [r]="PgUUIDBuilder";constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(es`gen_random_uuid()`)}build(e){return new t3(e,this.config)}}class t3 extends T{static [r]="PgUUID";getSQLType(){return"uuid"}}function t4(e){return new t6(e??"")}class t7 extends N{static [r]="PgVarcharBuilder";constructor(e,t){super(e,"string","PgVarchar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new ie(e,this.config)}}class ie extends T{static [r]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"varchar":`varchar(${this.length})`}}function it(e,t={}){let{name:i,config:s}=eT(e,t);return new t7(i,s)}class ii extends N{static [r]="PgBinaryVectorBuilder";constructor(e,t){super(e,"string","PgBinaryVector"),this.config.dimensions=t.dimensions}build(e){return new is(e,this.config)}}class is extends T{static [r]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}}function ir(e,t){let{name:i,config:s}=eT(e,t);return new ii(i,s)}class ia extends N{static [r]="PgHalfVectorBuilder";constructor(e,t){super(e,"array","PgHalfVector"),this.config.dimensions=t.dimensions}build(e){return new io(e,this.config)}}class io extends T{static [r]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(e=>Number.parseFloat(e))}}function il(e,t){let{name:i,config:s}=eT(e,t);return new ia(i,s)}class iu extends N{static [r]="PgSparseVectorBuilder";constructor(e,t){super(e,"string","PgSparseVector"),this.config.dimensions=t.dimensions}build(e){return new ic(e,this.config)}}class ic extends T{static [r]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}}function ih(e,t){let{name:i,config:s}=eT(e,t);return new iu(i,s)}class id extends N{static [r]="PgVectorBuilder";constructor(e,t){super(e,"array","PgVector"),this.config.dimensions=t.dimensions}build(e){return new ig(e,this.config)}}class ig extends T{static [r]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(e=>Number.parseFloat(e))}}function im(e,t){let{name:i,config:s}=eT(e,t);return new id(i,s)}let ip=Symbol.for("drizzle:PgInlineForeignKeys"),iy=Symbol.for("drizzle:EnableRLS");class ib extends J{static [r]="PgTable";static Symbol=Object.assign({},J.Symbol,{InlineForeignKeys:ip,EnableRLS:iy});[ip]=[];[iy]=!1;[J.Symbol.ExtraConfigBuilder]=void 0;[J.Symbol.ExtraConfigColumns]={}}let iw=(e,t,i)=>(function(e,t,i,s,n=e){let r=new ib(e,s,n),a="function"==typeof t?t({bigint:e_,bigserial:eI,boolean:eF,char:ez,cidr:eE,customType:eJ,date:eZ,doublePrecision:e1,inet:e5,integer:e3,interval:te,json:ts,jsonb:ta,line:th,macaddr:tg,macaddr8:ty,numeric:tP,point:t_,geometry:tO,real:tk,serial:tM,smallint:tU,smallserial:tW,text:tY,time:t0,timestamp:t9,uuid:t4,varchar:it,bit:ir,halfvec:il,sparsevec:ih,vector:im}):t,o=Object.fromEntries(Object.entries(a).map(([e,t])=>{t.setName(e);let i=t.build(r);return r[ip].push(...t.buildForeignKeys(i,r)),[e,i]})),l=Object.fromEntries(Object.entries(a).map(([e,t])=>(t.setName(e),[e,t.buildExtraConfigColumn(r)]))),u=Object.assign(r,o);return u[J.Symbol.Columns]=o,u[J.Symbol.ExtraConfigColumns]=l,i&&(u[ib.Symbol.ExtraConfigBuilder]=i),Object.assign(u,{enableRLS:()=>(u[ib.Symbol.EnableRLS]=!0,u)})})(e,t,i,void 0);class iS{constructor(e,t){this.name=e,this.value=t}static [r]="PgCheckBuilder";brand;build(e){return new iv(e,this)}}class iv{constructor(e,t){this.table=e,this.name=t.name,this.value=t.value}static [r]="PgCheck";name;value}class iN{constructor(e,t){this.unique=e,this.name=t}static [r]="PgIndexBuilderOn";on(...e){return new iT(e.map(e=>{if(a(e,Y))return e;let t=new $(e.name,!!e.keyAsName,e.columnType,e.indexConfig);return e.indexConfig=JSON.parse(JSON.stringify(e.defaultConfig)),t}),this.unique,!1,this.name)}onOnly(...e){return new iT(e.map(e=>{if(a(e,Y))return e;let t=new $(e.name,!!e.keyAsName,e.columnType,e.indexConfig);return e.indexConfig=e.defaultConfig,t}),this.unique,!0,this.name)}using(e,...t){return new iT(t.map(e=>{if(a(e,Y))return e;let t=new $(e.name,!!e.keyAsName,e.columnType,e.indexConfig);return e.indexConfig=JSON.parse(JSON.stringify(e.defaultConfig)),t}),this.unique,!0,this.name,e)}}class iT{static [r]="PgIndexBuilder";config;constructor(e,t,i,s,n="btree"){this.config={name:s,columns:e,unique:t,only:i,method:n}}concurrently(){return this.config.concurrently=!0,this}with(e){return this.config.with=e,this}where(e){return this.config.where=e,this}build(e){return new iP(this.config,e)}}class iP{static [r]="PgIndex";config;constructor(e,t){this.config={...e,table:t}}}function i$(e){return new iN(!1,e)}class ix{constructor(e,t){this.name=e,t&&(this.as=t.as,this.for=t.for,this.to=t.to,this.using=t.using,this.withCheck=t.withCheck)}static [r]="PgPolicy";as;for;to;using;withCheck;_linkedTable;link(e){return this._linkedTable=e,this}}class iC{static [r]="PgPrimaryKeyBuilder";columns;name;constructor(e,t){this.columns=e,this.name=t}build(e){return new iq(e,this.columns,this.name)}}class iq{constructor(e,t,i){this.table=e,this.columns=t,this.name=i}static [r]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[ib.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}}let i_=Symbol.for("drizzle:PgViewConfig");function iQ(e){return(e.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(e=>e.toLowerCase()).join("_")}function iD(e){return(e.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((e,t,i)=>e+(0===i?t.toLowerCase():`${t[0].toUpperCase()}${t.slice(1)}`),"")}function ij(e){return e}class iB{static [r]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert="snake_case"===e?iQ:"camelCase"===e?iD:ij}getColumnCasing(e){if(!e.keyAsName)return e.name;let t=e.table[J.Symbol.Schema]??"public",i=e.table[J.Symbol.OriginalName],s=`${t}.${i}.${e.name}`;return this.cache[s]||this.cacheTable(e.table),this.cache[s]}cacheTable(e){let t=e[J.Symbol.Schema]??"public",i=e[J.Symbol.OriginalName],s=`${t}.${i}`;if(!this.cachedTables[s]){for(let t of Object.values(e[J.Symbol.Columns])){let e=`${s}.${t.name}`;this.cache[e]=this.convert(t.name)}this.cachedTables[s]=!0}}clearCache(){this.cache={},this.cachedTables={}}}class iI extends Error{static [r]="DrizzleError";constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}}class iA extends Error{constructor(e,t,i){super(`Failed query: ${e}
params: ${t}`),this.query=e,this.params=t,this.cause=i,Error.captureStackTrace(this,iA),i&&(this.cause=i)}}class iO extends iI{static [r]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}function iF(e,t){return!X(t)||H(e)||a(e,ei)||a(e,ea)||a(e,h)||a(e,J)||a(e,eu)?e:new ei(e,t)}let iL=(e,t)=>es`${e} = ${iF(t,e)}`,ik=(e,t)=>es`${e} <> ${iF(t,e)}`;function iz(...e){let t=e.filter(e=>void 0!==e);if(0!==t.length)return new Y(1===t.length?t:[new G("("),es.join(t,new G(" and ")),new G(")")])}function iV(...e){let t=e.filter(e=>void 0!==e);if(0!==t.length)return new Y(1===t.length?t:[new G("("),es.join(t,new G(" or ")),new G(")")])}function iM(e){return es`not ${e}`}let iE=(e,t)=>es`${e} > ${iF(t,e)}`,iR=(e,t)=>es`${e} >= ${iF(t,e)}`,iU=(e,t)=>es`${e} < ${iF(t,e)}`,iJ=(e,t)=>es`${e} <= ${iF(t,e)}`;function iK(e,t){return Array.isArray(t)?0===t.length?es`false`:es`${e} in ${t.map(t=>iF(t,e))}`:es`${e} in ${iF(t,e)}`}function iW(e,t){return Array.isArray(t)?0===t.length?es`true`:es`${e} not in ${t.map(t=>iF(t,e))}`:es`${e} not in ${iF(t,e)}`}function iH(e){return es`${e} is null`}function iG(e){return es`${e} is not null`}function iY(e){return es`exists ${e}`}function iZ(e){return es`not exists ${e}`}function iX(e,t,i){return es`${e} between ${iF(t,e)} and ${iF(i,e)}`}function i0(e,t,i){return es`${e} not between ${iF(t,e)} and ${iF(i,e)}`}function i1(e,t){return es`${e} like ${t}`}function i2(e,t){return es`${e} not like ${t}`}function i8(e,t){return es`${e} ilike ${t}`}function i5(e,t){return es`${e} not ilike ${t}`}function i9(e){return es`${e} asc`}function i6(e){return es`${e} desc`}e.s(["and",()=>iz,"between",()=>iX,"eq",()=>iL,"exists",()=>iY,"gt",()=>iE,"gte",()=>iR,"ilike",()=>i8,"inArray",()=>iK,"isNotNull",()=>iG,"isNull",()=>iH,"like",()=>i1,"lt",()=>iU,"lte",()=>iJ,"ne",()=>ik,"not",()=>iM,"notBetween",()=>i0,"notExists",()=>iZ,"notIlike",()=>i5,"notInArray",()=>iW,"notLike",()=>i2,"or",()=>iV],75225),e.s(["asc",()=>i9,"desc",()=>i6],49129);class i3{constructor(e,t,i){this.sourceTable=e,this.referencedTable=t,this.relationName=i,this.referencedTableName=t[J.Symbol.Name]}static [r]="Relation";referencedTableName;fieldName}class i4{constructor(e,t){this.table=e,this.config=t}static [r]="Relations"}class i7 extends i3{constructor(e,t,i,s){super(e,t,i?.relationName),this.config=i,this.isNullable=s}static [r]="One";withFieldName(e){let t=new i7(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}}class se extends i3{constructor(e,t,i){super(e,t,i?.relationName),this.config=i}static [r]="Many";withFieldName(e){let t=new se(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}}function st(e,t){return new i4(e,e=>Object.fromEntries(Object.entries(t(e)).map(([e,t])=>[e,t.withFieldName(e)])))}function si(e){return{one:function(t,i){return new i7(e,t,i,i?.fields.reduce((e,t)=>e&&t.notNull,!0)??!1)},many:function(t,i){return new se(e,t,i)}}}class ss extends eu{static [r]="PgViewBase"}class sn{static [r]="PgDialect";casing;constructor(e){this.casing=new iB(e?.casing)}async migrate(e,t,i){let s="string"==typeof i?"__drizzle_migrations":i.migrationsTable??"__drizzle_migrations",n="string"==typeof i?"drizzle":i.migrationsSchema??"drizzle",r=es`
			CREATE TABLE IF NOT EXISTS ${es.identifier(n)}.${es.identifier(s)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(es`CREATE SCHEMA IF NOT EXISTS ${es.identifier(n)}`),await t.execute(r);let a=(await t.all(es`select id, hash, created_at from ${es.identifier(n)}.${es.identifier(s)} order by created_at desc limit 1`))[0];await t.transaction(async t=>{for await(let i of e)if(!a||Number(a.created_at)<i.folderMillis){for(let e of i.sql)await t.execute(es.raw(e));await t.execute(es`insert into ${es.identifier(n)}.${es.identifier(s)} ("hash", "created_at") values(${i.hash}, ${i.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[es`with `];for(let[i,s]of e.entries())t.push(es`${es.identifier(s._.alias)} as (${s._.sql})`),i<e.length-1&&t.push(es`, `);return t.push(es` `),es.join(t)}buildDeleteQuery({table:e,where:t,returning:i,withList:s}){let n=this.buildWithCTE(s),r=i?es` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,a=t?es` where ${t}`:void 0;return es`${n}delete from ${e}${a}${r}`}buildUpdateSet(e,t){let i=e[J.Symbol.Columns],s=Object.keys(i).filter(e=>void 0!==t[e]||i[e]?.onUpdateFn!==void 0),n=s.length;return es.join(s.flatMap((e,s)=>{let r=i[e],o=r.onUpdateFn?.(),l=t[e]??(a(o,Y)?o:es.param(o,r)),u=es`${es.identifier(this.casing.getColumnCasing(r))} = ${l}`;return s<n-1?[u,es.raw(", ")]:[u]}))}buildUpdateQuery({table:e,set:t,where:i,returning:s,withList:n,from:r,joins:a}){let o=this.buildWithCTE(n),l=e[ib.Symbol.Name],u=e[ib.Symbol.Schema],c=e[ib.Symbol.OriginalName],h=l===c?void 0:l,d=es`${u?es`${es.identifier(u)}.`:void 0}${es.identifier(c)}${h&&es` ${es.identifier(h)}`}`,f=this.buildUpdateSet(e,t),g=r&&es.join([es.raw(" from "),this.buildFromTable(r)]),m=this.buildJoins(a),p=s?es` returning ${this.buildSelection(s,{isSingleTable:!r})}`:void 0,y=i?es` where ${i}`:void 0;return es`${o}update ${d} set ${f}${g}${m}${y}${p}`}buildSelection(e,{isSingleTable:t=!1}={}){let i=e.length,s=e.flatMap(({field:e},s)=>{let n=[];if(a(e,Y.Aliased)&&e.isSelectionField)n.push(es.identifier(e.fieldAlias));else if(a(e,Y.Aliased)||a(e,Y)){let i=a(e,Y.Aliased)?e.sql:e;t?n.push(new Y(i.queryChunks.map(e=>a(e,T)?es.identifier(this.casing.getColumnCasing(e)):e))):n.push(i),a(e,Y.Aliased)&&n.push(es` as ${es.identifier(e.fieldAlias)}`)}else if(a(e,h))t?n.push(es.identifier(this.casing.getColumnCasing(e))):n.push(e);else if(a(e,I)){let t=Object.entries(e._.selectedFields);if(1===t.length){let i=t[0][1],s=a(i,Y)?i.decoder:a(i,h)?{mapFromDriverValue:e=>i.mapFromDriverValue(e)}:i.sql.decoder;s&&(e._.sql.decoder=s)}n.push(e)}return s<i-1&&n.push(es`, `),n});return es.join(s)}buildJoins(e){if(!e||0===e.length)return;let t=[];for(let[i,s]of e.entries()){0===i&&t.push(es` `);let n=s.table,r=s.lateral?es` lateral`:void 0,o=s.on?es` on ${s.on}`:void 0;if(a(n,ib)){let e=n[ib.Symbol.Name],i=n[ib.Symbol.Schema],a=n[ib.Symbol.OriginalName],l=e===a?void 0:s.alias;t.push(es`${es.raw(s.joinType)} join${r} ${i?es`${es.identifier(i)}.`:void 0}${es.identifier(a)}${l&&es` ${es.identifier(l)}`}${o}`)}else if(a(n,eu)){let e=n[F].name,i=n[F].schema,a=n[F].originalName,l=e===a?void 0:s.alias;t.push(es`${es.raw(s.joinType)} join${r} ${i?es`${es.identifier(i)}.`:void 0}${es.identifier(a)}${l&&es` ${es.identifier(l)}`}${o}`)}else t.push(es`${es.raw(s.joinType)} join${r} ${n}${o}`);i<e.length-1&&t.push(es` `)}return es.join(t)}buildFromTable(e){if(a(e,J)&&e[J.Symbol.IsAlias]){let t=es`${es.identifier(e[J.Symbol.OriginalName])}`;return e[J.Symbol.Schema]&&(t=es`${es.identifier(e[J.Symbol.Schema])}.${t}`),es`${t} ${es.identifier(e[J.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:t,fieldsFlat:i,where:s,having:n,table:r,joins:o,orderBy:l,groupBy:u,limit:c,offset:d,lockingClause:g,distinct:m,setOperators:p}){let y,b,w,S=i??eb(t);for(let e of S){let t;if(a(e.field,h)&&e.field.table[f]!==(a(r,I)?r._.alias:a(r,ss)?r[F].name:a(r,Y)?void 0:r[f])&&(t=e.field.table,!o?.some(({alias:e})=>e===(t[J.Symbol.IsAlias]?t[f]:t[J.Symbol.BaseName])))){let t=e.field.table[f];throw Error(`Your "${e.path.join("->")}" field references a column "${t}"."${e.field.name}", but the table "${t}" is not part of the query! Did you forget to join it?`)}}let v=!o||0===o.length,N=this.buildWithCTE(e);m&&(y=!0===m?es` distinct`:es` distinct on (${es.join(m.on,es`, `)})`);let T=this.buildSelection(S,{isSingleTable:v}),P=this.buildFromTable(r),$=this.buildJoins(o),x=s?es` where ${s}`:void 0,C=n?es` having ${n}`:void 0;l&&l.length>0&&(b=es` order by ${es.join(l,es`, `)}`),u&&u.length>0&&(w=es` group by ${es.join(u,es`, `)}`);let q="object"==typeof c||"number"==typeof c&&c>=0?es` limit ${c}`:void 0,_=d?es` offset ${d}`:void 0,Q=es.empty();if(g){let e=es` for ${es.raw(g.strength)}`;g.config.of&&e.append(es` of ${es.join(Array.isArray(g.config.of)?g.config.of:[g.config.of],es`, `)}`),g.config.noWait?e.append(es` nowait`):g.config.skipLocked&&e.append(es` skip locked`),Q.append(e)}let D=es`${N}select${y} ${T} from ${P}${$}${x}${w}${C}${b}${q}${_}${Q}`;return p.length>0?this.buildSetOperations(D,p):D}buildSetOperations(e,t){let[i,...s]=t;if(!i)throw Error("Cannot pass undefined values to any set operator");return 0===s.length?this.buildSetOperationQuery({leftSelect:e,setOperator:i}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:i}),s)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:i,rightSelect:s,limit:n,orderBy:r,offset:o}}){let l,u=es`(${e.getSQL()}) `,c=es`(${s.getSQL()})`;if(r&&r.length>0){let e=[];for(let t of r)if(a(t,T))e.push(es.identifier(t.name));else if(a(t,Y)){for(let e=0;e<t.queryChunks.length;e++){let i=t.queryChunks[e];a(i,T)&&(t.queryChunks[e]=es.identifier(i.name))}e.push(es`${t}`)}else e.push(es`${t}`);l=es` order by ${es.join(e,es`, `)} `}let h="object"==typeof n||"number"==typeof n&&n>=0?es` limit ${n}`:void 0,d=es.raw(`${t} ${i?"all ":""}`),f=o?es` offset ${o}`:void 0;return es`${u}${d}${c}${l}${h}${f}`}buildInsertQuery({table:e,values:t,onConflict:i,returning:s,withList:n,select:r,overridingSystemValue_:o}){let l=[],u=Object.entries(e[J.Symbol.Columns]).filter(([e,t])=>!t.shouldDisableInsert()),c=u.map(([,e])=>es.identifier(this.casing.getColumnCasing(e)));if(r)a(t,Y)?l.push(t):l.push(t.getSQL());else for(let[e,i]of(l.push(es.raw("values ")),t.entries())){let s=[];for(let[e,t]of u){let n=i[e];if(void 0===n||a(n,ei)&&void 0===n.value)if(void 0!==t.defaultFn){let e=t.defaultFn(),i=a(e,Y)?e:es.param(e,t);s.push(i)}else if(t.default||void 0===t.onUpdateFn)s.push(es`default`);else{let e=t.onUpdateFn(),i=a(e,Y)?e:es.param(e,t);s.push(i)}else s.push(n)}l.push(s),e<t.length-1&&l.push(es`, `)}let h=this.buildWithCTE(n),d=es.join(l),f=s?es` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,g=i?es` on conflict ${i}`:void 0,m=!0===o?es`overriding system value `:void 0;return es`${h}insert into ${e} ${c} ${m}${d}${g}${f}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:i}){let s=t?es` concurrently`:void 0,n=i?es` with no data`:void 0;return es`refresh materialized view${s} ${e}${n}`}prepareTyping(e){if(a(e,tr)||a(e,ti))return"json";if(a(e,tw))return"decimal";if(a(e,tX))return"time";if(a(e,t2)||a(e,t5))return"timestamp";if(a(e,eH)||a(e,eY))return"date";else if(a(e,t3))return"uuid";else return"none"}sqlToQuery(e,t){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:i,table:s,tableConfig:n,queryConfig:r,tableAlias:o,nestedQueryRelation:l,joinOn:u}){let c,d=[],f,g,m=[],p,y=[];if(!0===r)d=Object.entries(n.columns).map(([e,t])=>({dbKey:t.name,tsKey:e,field:eg(t,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let s=Object.fromEntries(Object.entries(n.columns).map(([e,t])=>[e,eg(t,o)]));if(r.where){let e="function"==typeof r.where?r.where(s,{and:iz,between:iX,eq:iL,exists:iY,gt:iE,gte:iR,ilike:i8,inArray:iK,isNull:iH,isNotNull:iG,like:i1,lt:iU,lte:iJ,ne:ik,not:iM,notBetween:i0,notExists:iZ,notLike:i2,notIlike:i5,notInArray:iW,or:iV,sql:es}):r.where;p=e&&ep(e,o)}let l=[],u=[];if(r.columns){let e=!1;for(let[t,i]of Object.entries(r.columns))void 0!==i&&t in n.columns&&(e||!0!==i||(e=!0),u.push(t));u.length>0&&(u=e?u.filter(e=>r.columns?.[e]===!0):Object.keys(n.columns).filter(e=>!u.includes(e)))}else u=Object.keys(n.columns);for(let e of u){let t=n.columns[e];l.push({tsKey:e,value:t})}let c=[];if(r.with&&(c=Object.entries(r.with).filter(e=>!!e[1]).map(([e,t])=>({tsKey:e,queryConfig:t,relation:n.relations[e]}))),r.extras)for(let[e,t]of Object.entries("function"==typeof r.extras?r.extras(s,{sql:es}):r.extras))l.push({tsKey:e,value:em(t,o)});for(let{tsKey:e,value:t}of l)d.push({dbKey:a(t,Y.Aliased)?t.fieldAlias:n.columns[e].name,tsKey:e,field:a(t,h)?eg(t,o):t,relationTableTsKey:void 0,isJson:!1,selection:[]});let b="function"==typeof r.orderBy?r.orderBy(s,{sql:es,asc:i9,desc:i6}):r.orderBy??[];for(let{tsKey:s,queryConfig:n,relation:l}of(Array.isArray(b)||(b=[b]),m=b.map(e=>a(e,h)?eg(e,o):ep(e,o)),f=r.limit,g=r.offset,c)){let r=function(e,t,i){if(a(i,i7)&&i.config)return{fields:i.config.fields,references:i.config.references};let s=t[K(i.referencedTable)];if(!s)throw Error(`Table "${i.referencedTable[J.Symbol.Name]}" not found in schema`);let n=e[s];if(!n)throw Error(`Table "${s}" not found in schema`);let r=i.sourceTable,o=t[K(r)];if(!o)throw Error(`Table "${r[J.Symbol.Name]}" not found in schema`);let l=[];for(let e of Object.values(n.relations))(i.relationName&&i!==e&&e.relationName===i.relationName||!i.relationName&&e.referencedTable===i.sourceTable)&&l.push(e);if(l.length>1)throw i.relationName?Error(`There are multiple relations with name "${i.relationName}" in table "${s}"`):Error(`There are multiple relations between "${s}" and "${i.sourceTable[J.Symbol.Name]}". Please specify relation name`);if(l[0]&&a(l[0],i7)&&l[0].config)return{fields:l[0].config.references,references:l[0].config.fields};throw Error(`There is not enough information to infer relation "${o}.${i.fieldName}"`)}(t,i,l),u=i[K(l.referencedTable)],c=`${o}_${s}`,h=iz(...r.fields.map((e,t)=>iL(eg(r.references[t],c),eg(e,o)))),f=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:i,table:e[u],tableConfig:t[u],queryConfig:a(l,i7)?!0===n?{limit:1}:{...n,limit:1}:n,tableAlias:c,joinOn:h,nestedQueryRelation:l}),g=es`${es.identifier(c)}.${es.identifier("data")}`.as(s);y.push({on:es`true`,table:new I(f.sql,{},c),alias:c,joinType:"left",lateral:!0}),d.push({dbKey:s,tsKey:s,field:g,relationTableTsKey:u,isJson:!0,selection:f.selection})}}if(0===d.length)throw new iI({message:`No fields selected for table "${n.tsName}" ("${o}")`});if(p=iz(u,p),l){let e=es`json_build_array(${es.join(d.map(({field:e,tsKey:t,isJson:i})=>i?es`${es.identifier(`${o}_${t}`)}.${es.identifier("data")}`:a(e,Y.Aliased)?e.sql:e),es`, `)})`;a(l,se)&&(e=es`coalesce(json_agg(${e}${m.length>0?es` order by ${es.join(m,es`, `)}`:void 0}), '[]'::json)`);let t=[{dbKey:"data",tsKey:"data",field:e.as("data"),isJson:!0,relationTableTsKey:n.tsName,selection:d}];void 0!==f||void 0!==g||m.length>0?(c=this.buildSelectQuery({table:ef(s,o),fields:{},fieldsFlat:[{path:[],field:es.raw("*")}],where:p,limit:f,offset:g,orderBy:m,setOperators:[]}),p=void 0,f=void 0,g=void 0,m=[]):c=ef(s,o),c=this.buildSelectQuery({table:a(c,ib)?c:new I(c,{},o),fields:{},fieldsFlat:t.map(({field:e})=>({path:[],field:a(e,h)?eg(e,o):e})),joins:y,where:p,limit:f,offset:g,orderBy:m,setOperators:[]})}else c=this.buildSelectQuery({table:ef(s,o),fields:{},fieldsFlat:d.map(({field:e})=>({path:[],field:a(e,h)?eg(e,o):e})),joins:y,where:p,limit:f,offset:g,orderBy:m,setOperators:[]});return{tableTsKey:n.tsName,sql:c,selection:d}}}class sr{static [r]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class sa{static [r]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let t,i=!!this.fields;return t=this.fields?this.fields:a(e,I)?Object.fromEntries(Object.keys(e._.selectedFields).map(t=>[t,e[t]])):a(e,ss)?e[F].selectedFields:a(e,Y)?{}:ev(e),new sl({table:e,fields:t,isPartialSelect:i,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}}class so extends sr{static [r]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:e,fields:t,isPartialSelect:i,session:s,dialect:n,withList:r,distinct:a}){for(const o of(super(),this.config={withList:r,table:e,fields:{...t},distinct:a,setOperators:[]},this.isPartialSelect=i,this.session=s,this.dialect=n,this._={selectedFields:t,config:this.config},this.tableName=eN(e),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{},sC(e)))this.usedTables.add(o)}getUsedTables(){return[...this.usedTables]}createJoin(e,t){return(i,s)=>{let n=this.tableName,r=eN(i);for(let e of sC(i))this.usedTables.add(e);if("string"==typeof r&&this.config.joins?.some(e=>e.alias===r))throw Error(`Alias "${r}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof n&&(this.config.fields={[n]:this.config.fields}),"string"==typeof r&&!a(i,Y))){let e=a(i,I)?i._.selectedFields:a(i,eu)?i[F].selectedFields:i[J.Symbol.Columns];this.config.fields[r]=e}if("function"==typeof s&&(s=s(new Proxy(this.config.fields,new ey({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:s,table:i,joinType:e,alias:r,lateral:t}),"string"==typeof r)switch(e){case"left":this.joinsNotNullableMap[r]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[r]=!0;break;case"cross":case"inner":this.joinsNotNullableMap[r]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[r]=!1}return this}}leftJoin=this.createJoin("left",!1);leftJoinLateral=this.createJoin("left",!0);rightJoin=this.createJoin("right",!1);innerJoin=this.createJoin("inner",!1);innerJoinLateral=this.createJoin("inner",!0);fullJoin=this.createJoin("full",!1);crossJoin=this.createJoin("cross",!1);crossJoinLateral=this.createJoin("cross",!0);createSetOperator(e,t){return i=>{let s="function"==typeof i?i(sc()):i;if(!ew(this.getSelectedFields(),s.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:s}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new ey({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new ey({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if("function"==typeof e[0]){let t=e[0](new Proxy(this.config.fields,new ey({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if("function"==typeof e[0]){let t=e[0](new Proxy(this.config.fields,new ey({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),i=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}else this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=e:this.config.orderBy=e;return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){let t=[];if(t.push(...sC(this.config.table)),this.config.joins)for(let e of this.config.joins)t.push(...sC(e.table));return new Proxy(new I(this.getSQL(),this.config.fields,e,!1,[...new Set(t)]),new ey({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new ey({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}$withCache(e){return this.cacheConfig=void 0===e?{config:{},enable:!0,autoInvalidate:!0}:!1===e?{enable:!1}:{enable:!0,autoInvalidate:!0,...e},this}}class sl extends so{static [r]="PgSelect";_prepare(e){let{session:t,config:i,dialect:s,joinsNotNullableMap:n,authToken:r,cacheConfig:a,usedTables:o}=this;if(!t)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let{fields:l}=i;return O("drizzle.prepareQuery",()=>{let i=eb(l),u=t.prepareQuery(s.sqlToQuery(this.getSQL()),i,e,!0,void 0,{type:"select",tables:[...o]},a);return u.joinsNotNullableMap=n,u.setToken(r)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>O("drizzle.operation",()=>this._prepare().execute(e,this.authToken))}for(let e of[c])for(let t of Object.getOwnPropertyNames(e.prototype))"constructor"!==t&&Object.defineProperty(sl.prototype,t,Object.getOwnPropertyDescriptor(e.prototype,t)||Object.create(null));function su(e,t){return(i,s,...n)=>{let r=[s,...n].map(i=>({type:e,isAll:t,rightSelect:i}));for(let e of r)if(!ew(i.getSelectedFields(),e.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return i.addSetOperators(r)}}let sc=()=>({union:sh,unionAll:sd,intersect:sf,intersectAll:sg,except:sm,exceptAll:sp}),sh=su("union",!1),sd=su("union",!0),sf=su("intersect",!1),sg=su("intersect",!0),sm=su("except",!1),sp=su("except",!0);class sy{static [r]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=a(e,sn)?e:void 0,this.dialectConfig=a(e,sn)?void 0:e}$with=(e,t)=>{let i=this;return{as:s=>("function"==typeof s&&(s=s(i)),new Proxy(new A(s.getSQL(),t??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new ey({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let t=this;return{select:function(i){return new sa({fields:i??void 0,session:void 0,dialect:t.getDialect(),withList:e})},selectDistinct:function(e){return new sa({fields:e??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})},selectDistinctOn:function(e,i){return new sa({fields:i??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:e}})}}}select(e){return new sa({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new sa({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new sa({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new sn(this.dialectConfig)),this.dialect}}class sb{constructor(e,t){this.name=e,this.schema=t}static [r]="PgDefaultViewBuilderCore";config={};with(e){return this.config.with=e,this}}class sw extends sb{static [r]="PgViewBuilder";as(e){"function"==typeof e&&(e=e(new sy));let t=new ey({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),i=new Proxy(e.getSelectedFields(),t);return new Proxy(new sP({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:i,query:e.getSQL().inlineParams()}}),t)}}class sS extends sb{static [r]="PgManualViewBuilder";columns;constructor(e,t,i){super(e,i),this.columns=ev(iw(e,t))}existing(){return new Proxy(new sP({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new ey({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(e){return new Proxy(new sP({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:e.inlineParams()}}),new ey({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}}class sv{constructor(e,t){this.name=e,this.schema=t}static [r]="PgMaterializedViewBuilderCore";config={};using(e){return this.config.using=e,this}with(e){return this.config.with=e,this}tablespace(e){return this.config.tablespace=e,this}withNoData(){return this.config.withNoData=!0,this}}class sN extends sv{static [r]="PgMaterializedViewBuilder";as(e){"function"==typeof e&&(e=e(new sy));let t=new ey({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),i=new Proxy(e.getSelectedFields(),t);return new Proxy(new sx({pgConfig:{with:this.config.with,using:this.config.using,tablespace:this.config.tablespace,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:i,query:e.getSQL().inlineParams()}}),t)}}class sT extends sv{static [r]="PgManualMaterializedViewBuilder";columns;constructor(e,t,i){super(e,i),this.columns=ev(iw(e,t))}existing(){return new Proxy(new sx({pgConfig:{tablespace:this.config.tablespace,using:this.config.using,with:this.config.with,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new ey({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(e){return new Proxy(new sx({pgConfig:{tablespace:this.config.tablespace,using:this.config.using,with:this.config.with,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:e.inlineParams()}}),new ey({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}}class sP extends ss{static [r]="PgView";[i_];constructor({pgConfig:e,config:t}){super(t),e&&(this[i_]={with:e.with})}}let s$=Symbol.for("drizzle:PgMaterializedViewConfig");class sx extends ss{static [r]="PgMaterializedView";[s$];constructor({pgConfig:e,config:t}){super(t),this[s$]={with:e?.with,using:e?.using,tablespace:e?.tablespace,withNoData:e?.withNoData}}}function sC(e){return a(e,ib)?[e[L]?`${e[L]}.${e[J.Symbol.BaseName]}`:e[J.Symbol.BaseName]]:a(e,I)?e._.usedTables??[]:a(e,Y)?e.usedTables??[]:[]}class sq extends c{constructor(e,t,i,s){super(),this.session=t,this.dialect=i,this.config={table:e,withList:s}}static [r]="PgDelete";config;cacheConfig;where(e){return this.config.where=e,this}returning(e=this.config.table[J.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=eb(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return O("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"delete",tables:sC(this.config.table)},this.cacheConfig))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>O("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ey({alias:this.config.table[f],sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class s_{constructor(e,t,i,s,n){this.table=e,this.session=t,this.dialect=i,this.withList=s,this.overridingSystemValue_=n}static [r]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(0===(e=Array.isArray(e)?e:[e]).length)throw Error("values() must be called with at least one value");let t=e.map(e=>{let t={},i=this.table[J.Symbol.Columns];for(let s of Object.keys(e)){let n=e[s];t[s]=a(n,Y)?n:new ei(n,i[s])}return t});return new sQ(this.table,t,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let t="function"==typeof e?e(new sy):e;if(!a(t,Y)&&!ew(this.table[k],t._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new sQ(this.table,t,this.session,this.dialect,this.withList,!0)}}class sQ extends c{constructor(e,t,i,s,n,r,a){super(),this.session=i,this.dialect=s,this.config={table:e,values:t,withList:n,select:r,overridingSystemValue_:a}}static [r]="PgInsert";config;cacheConfig;returning(e=this.config.table[J.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=eb(e),this}onConflictDoNothing(e={}){if(void 0===e.target)this.config.onConflict=es`do nothing`;else{let t="";t=Array.isArray(e.target)?e.target.map(e=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(e))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let i=e.where?es` where ${e.where}`:void 0;this.config.onConflict=es`(${es.raw(t)})${i} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let t=e.where?es` where ${e.where}`:void 0,i=e.targetWhere?es` where ${e.targetWhere}`:void 0,s=e.setWhere?es` where ${e.setWhere}`:void 0,n=this.dialect.buildUpdateSet(this.config.table,eS(this.config.table,e.set)),r="";return r=Array.isArray(e.target)?e.target.map(e=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(e))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=es`(${es.raw(r)})${i} do update set ${n}${t}${s}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return O("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"insert",tables:sC(this.config.table)},this.cacheConfig))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>O("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ey({alias:this.config.table[f],sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class sD{constructor(e,t,i,s){this.table=e,this.session=t,this.dialect=i,this.withList=s}static [r]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new sj(this.table,eS(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}}class sj extends c{constructor(e,t,i,s,n){super(),this.session=i,this.dialect=s,this.config={set:t,table:e,withList:n,joins:[]},this.tableName=eN(e),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{}}static [r]="PgUpdate";config;tableName;joinsNotNullableMap;cacheConfig;from(e){let t=eN(e);return"string"==typeof t&&(this.joinsNotNullableMap[t]=!0),this.config.from=e,this}getTableLikeFields(e){return a(e,ib)?e[J.Symbol.Columns]:a(e,I)?e._.selectedFields:e[F].selectedFields}createJoin(e){return(t,i)=>{let s=eN(t);if("string"==typeof s&&this.config.joins.some(e=>e.alias===s))throw Error(`Alias "${s}" is already used in this query`);if("function"==typeof i){let e=this.config.from&&!a(this.config.from,Y)?this.getTableLikeFields(this.config.from):void 0;i=i(new Proxy(this.config.table[J.Symbol.Columns],new ey({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),e&&new Proxy(e,new ey({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:i,table:t,joinType:e,alias:s}),"string"==typeof s)switch(e){case"left":this.joinsNotNullableMap[s]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[s]=!0;break;case"inner":this.joinsNotNullableMap[s]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[s]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[J.Symbol.Columns]),this.config.from)){let t=eN(this.config.from);if("string"==typeof t&&this.config.from&&!a(this.config.from,Y)){let i=this.getTableLikeFields(this.config.from);e[t]=i}for(let t of this.config.joins){let i=eN(t.table);if("string"==typeof i&&!a(t.table,Y)){let s=this.getTableLikeFields(t.table);e[i]=s}}}return this.config.returningFields=e,this.config.returning=eb(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){let t=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"insert",tables:sC(this.config.table)},this.cacheConfig);return t.joinsNotNullableMap=this.joinsNotNullableMap,t}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ey({alias:this.config.table[f],sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class sB extends Y{constructor(e){super(sB.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=sB.buildCount(e.source,e.filters)}sql;token;static [r]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,t){return es`(select count(*) from ${e}${es.raw(" where ").if(t)}${t})`}static buildCount(e,t){return es`select count(*) as count from ${e}${es.raw(" where ").if(t)}${t};`}setToken(e){return this.token=e,this}then(e,t){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,t)}catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}}class sI{constructor(e,t,i,s,n,r,a){this.fullSchema=e,this.schema=t,this.tableNamesMap=i,this.table=s,this.tableConfig=n,this.dialect=r,this.session=a}static [r]="PgRelationalQueryBuilder";findMany(e){return new sA(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new sA(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}}class sA extends c{constructor(e,t,i,s,n,r,a,o,l){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=i,this.table=s,this.tableConfig=n,this.dialect=r,this.session=a,this.config=o,this.mode=l}static [r]="PgRelationalQuery";_prepare(e){return O("drizzle.prepareQuery",()=>{let{query:t,builtQuery:i}=this._toSQL();return this.session.prepareQuery(i,void 0,e,!0,(e,i)=>{let s=e.map(e=>(function e(t,i,s,n,r=e=>e){let o={};for(let[l,u]of n.entries())if(u.isJson){let n=i.relations[u.tsKey],c=s[l],h="string"==typeof c?JSON.parse(c):c;o[u.tsKey]=a(n,i7)?h&&e(t,t[u.relationTableTsKey],h,u.selection,r):h.map(i=>e(t,t[u.relationTableTsKey],i,u.selection,r))}else{let e,t=r(s[l]),i=u.field;e=a(i,h)?i:a(i,Y)?i.decoder:i.sql.decoder,o[u.tsKey]=null===t?null:e.mapFromDriverValue(t)}return o})(this.schema,this.tableConfig,e,t.selection,i));return"first"===this.mode?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),t=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:t}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return O("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}}class sO extends c{constructor(e,t,i,s){super(),this.execute=e,this.sql=t,this.query=i,this.mapBatchResult=s}static [r]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}}class sF extends c{constructor(e,t,i){super(),this.session=t,this.dialect=i,this.config={view:e}}static [r]="PgRefreshMaterializedView";config;concurrently(){if(void 0!==this.config.withNoData)throw Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(void 0!==this.config.concurrently)throw Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return O("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>O("drizzle.operation",()=>this._prepare().execute(e,this.authToken))}class sL{constructor(e,t,i){if(this.dialect=e,this.session=t,this._=i?{schema:i.schema,fullSchema:i.fullSchema,tableNamesMap:i.tableNamesMap,session:t}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:t},this.query={},this._.schema)for(const[s,n]of Object.entries(this._.schema))this.query[s]=new sI(i.fullSchema,this._.schema,this._.tableNamesMap,i.fullSchema[s],n,e,t);this.$cache={invalidate:async e=>{}}}static [r]="PgDatabase";query;$with=(e,t)=>{let i=this;return{as:s=>("function"==typeof s&&(s=s(new sy(i.dialect))),new Proxy(new A(s.getSQL(),t??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new ey({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,t){return new sB({source:e,filters:t,session:this.session})}$cache;with(...e){let t=this;return{select:function(i){return new sa({fields:i??void 0,session:t.session,dialect:t.dialect,withList:e})},selectDistinct:function(i){return new sa({fields:i??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})},selectDistinctOn:function(i,s){return new sa({fields:s??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:{on:i}})},update:function(i){return new sD(i,t.session,t.dialect,e)},insert:function(i){return new s_(i,t.session,t.dialect,e)},delete:function(i){return new sq(i,t.session,t.dialect,e)}}}select(e){return new sa({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new sa({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,t){return new sa({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new sD(e,this.session,this.dialect)}insert(e){return new s_(e,this.session,this.dialect)}delete(e){return new sq(e,this.session,this.dialect)}refreshMaterializedView(e){return new sF(e,this.session,this.dialect)}authToken;execute(e){let t="string"==typeof e?es.raw(e):e.getSQL(),i=this.dialect.sqlToQuery(t),s=this.session.prepareQuery(i,void 0,void 0,!1);return new sO(()=>s.execute(void 0,this.authToken),t,i,e=>s.mapResult(e,!0))}transaction(e,t){return this.session.transaction(e,t)}}class sk{static [r]="Cache"}class sz extends sk{strategy(){return"all"}static [r]="NoopCache";async get(e){}async put(e,t,i,s){}async onMutate(e){}}async function sV(e,t){let i=`${e}-${JSON.stringify(t)}`,s=new TextEncoder().encode(i);return[...new Uint8Array(await crypto.subtle.digest("SHA-256",s))].map(e=>e.toString(16).padStart(2,"0")).join("")}class sM{constructor(e,t,i,s){this.query=e,this.cache=t,this.queryMetadata=i,this.cacheConfig=s,t&&"all"===t.strategy()&&void 0===s&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),this.cacheConfig?.enable||(this.cacheConfig=void 0)}authToken;getQuery(){return this.query}mapResult(e,t){return e}setToken(e){return this.authToken=e,this}static [r]="PgPreparedQuery";joinsNotNullableMap;async queryWithCache(e,t,i){if(void 0===this.cache||a(this.cache,sz)||void 0===this.queryMetadata||this.cacheConfig&&!this.cacheConfig.enable)try{return await i()}catch(i){throw new iA(e,t,i)}if(("insert"===this.queryMetadata.type||"update"===this.queryMetadata.type||"delete"===this.queryMetadata.type)&&this.queryMetadata.tables.length>0)try{let[e]=await Promise.all([i(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return e}catch(i){throw new iA(e,t,i)}if(!this.cacheConfig)try{return await i()}catch(i){throw new iA(e,t,i)}if("select"===this.queryMetadata.type){let s=await this.cache.get(this.cacheConfig.tag??await sV(e,t),this.queryMetadata.tables,void 0!==this.cacheConfig.tag,this.cacheConfig.autoInvalidate);if(void 0===s){let s;try{s=await i()}catch(i){throw new iA(e,t,i)}return await this.cache.put(this.cacheConfig.tag??await sV(e,t),s,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],void 0!==this.cacheConfig.tag,this.cacheConfig.config),s}return s}try{return await i()}catch(i){throw new iA(e,t,i)}}}class sE{constructor(e){this.dialect=e}static [r]="PgSession";execute(e,t){return O("drizzle.operation",()=>O("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(t).execute(void 0,t))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,t){return Number((await this.execute(e,t))[0].count)}}class sR extends sL{constructor(e,t,i,s=0){super(e,t,i),this.schema=i,this.nestedIndex=s}static [r]="PgTransaction";rollback(){throw new iO}getTransactionConfigSQL(e){let t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),"boolean"==typeof e.deferrable&&t.push(e.deferrable?"deferrable":"not deferrable"),es.raw(t.join(" "))}setTransaction(e){return this.session.execute(es`set transaction ${this.getTransactionConfigSQL(e)}`)}}let sU={arrayMode:!1,fullResults:!0},sJ={arrayMode:!0,fullResults:!0};class sK extends sM{constructor(e,t,i,s,n,r,a,o,l){super(t,s,n,r),this.client=e,this.logger=i,this.fields=a,this._isResponseInArrayMode=o,this.customResultMapper=l,this.clientQuery=e.query??e}static [r]="NeonHttpPreparedQuery";clientQuery;async execute(e={},t=this.authToken){let i=eo(this.query.params,e);this.logger.logQuery(this.query.sql,i);let{fields:s,clientQuery:n,query:r,customResultMapper:a}=this;if(!s&&!a)return this.queryWithCache(r.sql,i,async()=>n(r.sql,i,void 0===t?sU:{...sU,authToken:t}));let o=await this.queryWithCache(r.sql,i,async()=>await n(r.sql,i,void 0===t?sJ:{...sJ,authToken:t}));return this.mapResult(o)}mapResult(e){if(!this.fields&&!this.customResultMapper)return e;let t=e.rows;return this.customResultMapper?this.customResultMapper(t):t.map(e=>(function(e,t,i){let s={},n=e.reduce((e,{path:n,field:r},o)=>{let l;l=a(r,h)?r:a(r,Y)?r.decoder:a(r,I)?r._.sql.decoder:r.sql.decoder;let u=e;for(let[e,c]of n.entries())if(e<n.length-1)c in u||(u[c]={}),u=u[c];else{let e=t[o],d=u[c]=null===e?null:l.mapFromDriverValue(e);if(i&&a(r,h)&&2===n.length){let e=n[0];e in s?"string"==typeof s[e]&&s[e]!==r.table[f]&&(s[e]=!1):s[e]=null===d&&r.table[f]}}return e},{});if(i&&Object.keys(s).length>0)for(let[e,t]of Object.entries(s))"string"!=typeof t||i[t]||(n[e]=null);return n})(this.fields,e,this.joinsNotNullableMap))}all(e={}){let t=eo(this.query.params,e);return this.logger.logQuery(this.query.sql,t),this.clientQuery(this.query.sql,t,void 0===this.authToken?sU:{...sU,authToken:this.authToken}).then(e=>e.rows)}values(e={},t){let i=eo(this.query.params,e);return this.logger.logQuery(this.query.sql,i),this.clientQuery(this.query.sql,i,{arrayMode:!0,fullResults:!0,authToken:t}).then(e=>e.rows)}isResponseInArrayMode(){return this._isResponseInArrayMode}}class sW extends sE{constructor(e,t,i,s={}){super(t),this.client=e,this.schema=i,this.options=s,this.clientQuery=e.query??e,this.logger=s.logger??new u,this.cache=s.cache??new sz}static [r]="NeonHttpSession";clientQuery;logger;cache;prepareQuery(e,t,i,s,n,r,a){return new sK(this.client,e,this.logger,this.cache,r,a,t,s,n)}async batch(e){let t=[],i=[];for(let s of e){let e=s._prepare(),n=e.getQuery();t.push(e),i.push(this.clientQuery(n.sql,n.params,{fullResults:!0,arrayMode:e.isResponseInArrayMode()}))}return(await this.client.transaction(i,sJ)).map((e,i)=>t[i].mapResult(e,!0))}async query(e,t){return this.logger.logQuery(e,t),await this.clientQuery(e,t,{arrayMode:!0,fullResults:!0})}async queryObjects(e,t){return this.clientQuery(e,t,{arrayMode:!1,fullResults:!0})}async count(e,t){return Number((await this.execute(e,t)).rows[0].count)}async transaction(e,t={}){throw Error("No transactions support in neon-http driver")}}class sH extends sR{static [r]="NeonHttpTransaction";async transaction(e){throw Error("No transactions support in neon-http driver")}}class sG{constructor(e,t,i={}){this.client=e,this.dialect=t,this.options=i,this.initMappers()}static [r]="NeonHttpDriver";createSession(e){return new sW(this.client,this.dialect,e,{logger:this.options.logger,cache:this.options.cache})}initMappers(){n.types.setTypeParser(n.types.builtins.TIMESTAMPTZ,e=>e),n.types.setTypeParser(n.types.builtins.TIMESTAMP,e=>e),n.types.setTypeParser(n.types.builtins.DATE,e=>e),n.types.setTypeParser(n.types.builtins.INTERVAL,e=>e),n.types.setTypeParser(1231,e=>e),n.types.setTypeParser(1115,e=>e),n.types.setTypeParser(1185,e=>e),n.types.setTypeParser(1187,e=>e),n.types.setTypeParser(1182,e=>e)}}function sY(e,t,i,s){return new Proxy(e,{get(e,n){let r=e[n];return"function"!=typeof r&&("object"!=typeof r||null===r)?r:s?sY(r,t,i):"query"===n?sY(r,t,i,!0):new Proxy(r,{apply(e,s,r){let a=e.call(s,...r);return"object"==typeof a&&null!==a&&"setToken"in a&&"function"==typeof a.setToken&&a.setToken(t),i(e,n,a)}})}})}class sZ extends sL{static [r]="NeonHttpDatabase";$withAuth(e){return this.authToken=e,sY(this,e,(t,i,s)=>"with"===i?sY(s,e,(e,t,i)=>i):s)}async batch(e){return this.session.batch(e)}}function sX(e,t={}){let i,s,n=new sn({casing:t.casing});if(!0===t.logger?i=new l:!1!==t.logger&&(i=t.logger),t.schema){let e=function(e,t){1===Object.keys(e).length&&"default"in e&&!a(e.default,J)&&(e=e.default);let i={},s={},n={};for(let[r,o]of Object.entries(e))if(a(o,J)){let e=K(o),t=s[e];for(let s of(i[e]=r,n[r]={tsName:r,dbName:o[J.Symbol.Name],schema:o[J.Symbol.Schema],columns:o[J.Symbol.Columns],relations:t?.relations??{},primaryKey:t?.primaryKey??[]},Object.values(o[J.Symbol.Columns])))s.primary&&n[r].primaryKey.push(s);let l=o[J.Symbol.ExtraConfigBuilder]?.(o[J.Symbol.ExtraConfigColumns]);if(l)for(let e of Object.values(l))a(e,iC)&&n[r].primaryKey.push(...e.columns)}else if(a(o,i4)){let e,r=K(o.table),a=i[r];for(let[i,l]of Object.entries(o.config(t(o.table))))if(a){let t=n[a];t.relations[i]=l,e&&t.primaryKey.push(...e)}else r in s||(s[r]={relations:{},primaryKey:e}),s[r].relations[i]=l}return{tables:n,tableNamesMap:i}}(t.schema,si);s={fullSchema:t.schema,schema:e.tables,tableNamesMap:e.tableNamesMap}}let r=new sG(e,n,{logger:i,cache:t.cache}).createSession(s),o=new sZ(n,r,s);return o.$client=e,o.$cache=t.cache,o.$cache&&(o.$cache.invalidate=t.cache?.onMutate),o}function s0(...e){if("string"==typeof e[0])return sX((0,n.neon)(e[0]),e[1]);if(function(e){if("object"!=typeof e||null===e||"Object"!==e.constructor.name)return!1;if("logger"in e){let t=typeof e.logger;return"boolean"===t||"object"===t&&"function"==typeof e.logger.logQuery||"undefined"===t}if("schema"in e){let t=typeof e.schema;return"object"===t||"undefined"===t}if("casing"in e){let t=typeof e.casing;return"string"===t||"undefined"===t}if("mode"in e)return"default"===e.mode&&"planetscale"===e.mode&&void 0===e.mode;if("connection"in e){let t=typeof e.connection;return"string"===t||"object"===t||"undefined"===t}if("client"in e){let t=typeof e.client;return"object"===t||"function"===t||"undefined"===t}return 0===Object.keys(e).length}(e[0])){let{connection:t,client:i,...s}=e[0];if(i)return sX(i,s);if("object"==typeof t){let{connectionString:e,...i}=t;return sX((0,n.neon)(e,i),s)}return sX((0,n.neon)(t),s)}return sX(e[0],e[1])}(s0||(s0={})).mock=function(e){return sX({},e)};let s1=B("user_role",["creator","fan"]),s2=B("content_status",["draft","published","archived"]),s8=B("content_type",["youtube_preview","upload"]),s5=B("payment_status",["pending","paid","failed","refunded"]),s9=iw("profiles",{id:t4("id").primaryKey().defaultRandom(),userId:tY("user_id").notNull().unique(),role:s1("role").notNull().default("fan"),handle:tY("handle").notNull().unique(),displayName:tY("display_name"),bio:tY("bio"),avatarUrl:tY("avatar_url"),createdAt:t9("created_at").defaultNow().notNull(),updatedAt:t9("updated_at").defaultNow().notNull()},e=>({handleIdx:i$("profiles_handle_idx").on(e.handle),userIdIdx:i$("profiles_user_id_idx").on(e.userId)})),s6=iw("creator_profiles",{id:t4("id").primaryKey().defaultRandom(),profileId:t4("profile_id").notNull().references(()=>s9.id,{onDelete:"cascade"}),verificationStatus:tY("verification_status").default("unverified"),payoutPhone:tY("payout_phone"),totalEarnings:tP("total_earnings",{precision:12,scale:2}).default("0"),createdAt:t9("created_at").defaultNow().notNull(),updatedAt:t9("updated_at").defaultNow().notNull()},e=>({profileIdIdx:i$("creator_profiles_profile_id_idx").on(e.profileId)})),s3=iw("content",{id:t4("id").primaryKey().defaultRandom(),creatorId:t4("creator_id").notNull().references(()=>s9.id,{onDelete:"cascade"}),title:tY("title").notNull(),description:tY("description"),category:tY("category").notNull(),status:s2("status").notNull().default("draft"),contentType:s8("content_type").notNull(),priceTzs:e3("price_tzs").notNull(),viewCount:e3("view_count").default(0),likeCount:e3("like_count").default(0),commentCount:e3("comment_count").default(0),createdAt:t9("created_at").defaultNow().notNull(),updatedAt:t9("updated_at").defaultNow().notNull(),publishedAt:t9("published_at")},e=>({creatorIdIdx:i$("content_creator_id_idx").on(e.creatorId),statusIdx:i$("content_status_idx").on(e.status),categoryIdx:i$("content_category_idx").on(e.category),publishedAtIdx:i$("content_published_at_idx").on(e.publishedAt)})),s4=iw("content_media",{id:t4("id").primaryKey().defaultRandom(),contentId:t4("content_id").notNull().references(()=>s3.id,{onDelete:"cascade"}),mediaType:tY("media_type").notNull(),url:tY("url"),storageKey:tY("storage_key"),duration:e3("duration"),createdAt:t9("created_at").defaultNow().notNull()},e=>({contentIdIdx:i$("content_media_content_id_idx").on(e.contentId)})),s7=iw("payment_intents",{id:t4("id").primaryKey().defaultRandom(),userId:t4("user_id").notNull().references(()=>s9.id,{onDelete:"cascade"}),contentId:t4("content_id").notNull().references(()=>s3.id,{onDelete:"cascade"}),amountTzs:e3("amount_tzs").notNull(),status:s5("status").notNull().default("pending"),provider:tY("provider"),providerReference:tY("provider_reference"),phoneNumber:tY("phone_number"),metadata:tY("metadata"),createdAt:t9("created_at").defaultNow().notNull(),updatedAt:t9("updated_at").defaultNow().notNull(),paidAt:t9("paid_at")},e=>({userIdIdx:i$("payment_intents_user_id_idx").on(e.userId),contentIdIdx:i$("payment_intents_content_id_idx").on(e.contentId),statusIdx:i$("payment_intents_status_idx").on(e.status),providerRefIdx:i$("payment_intents_provider_ref_idx").on(e.providerReference)})),ne=iw("entitlements",{id:t4("id").primaryKey().defaultRandom(),userId:t4("user_id").notNull().references(()=>s9.id,{onDelete:"cascade"}),contentId:t4("content_id").notNull().references(()=>s3.id,{onDelete:"cascade"}),paymentIntentId:t4("payment_intent_id").references(()=>s7.id),grantedAt:t9("granted_at").defaultNow().notNull()},e=>({userContentIdx:i$("entitlements_user_content_idx").on(e.userId,e.contentId),contentIdIdx:i$("entitlements_content_id_idx").on(e.contentId)})),nt=iw("follows",{id:t4("id").primaryKey().defaultRandom(),followerId:t4("follower_id").notNull().references(()=>s9.id,{onDelete:"cascade"}),creatorId:t4("creator_id").notNull().references(()=>s9.id,{onDelete:"cascade"}),createdAt:t9("created_at").defaultNow().notNull()},e=>({followerCreatorIdx:i$("follows_follower_creator_idx").on(e.followerId,e.creatorId)})),ni=iw("likes",{id:t4("id").primaryKey().defaultRandom(),userId:t4("user_id").notNull().references(()=>s9.id,{onDelete:"cascade"}),contentId:t4("content_id").notNull().references(()=>s3.id,{onDelete:"cascade"}),createdAt:t9("created_at").defaultNow().notNull()},e=>({userContentIdx:i$("likes_user_content_idx").on(e.userId,e.contentId)})),ns=iw("comments",{id:t4("id").primaryKey().defaultRandom(),userId:t4("user_id").notNull().references(()=>s9.id,{onDelete:"cascade"}),contentId:t4("content_id").notNull().references(()=>s3.id,{onDelete:"cascade"}),body:tY("body").notNull(),createdAt:t9("created_at").defaultNow().notNull(),updatedAt:t9("updated_at").defaultNow().notNull()},e=>({contentIdIdx:i$("comments_content_id_idx").on(e.contentId),createdAtIdx:i$("comments_created_at_idx").on(e.createdAt)})),nn=st(s9,({one:e,many:t})=>({creatorProfile:e(s6,{fields:[s9.id],references:[s6.profileId]}),content:t(s3),paymentIntents:t(s7),entitlements:t(ne),following:t(nt,{relationName:"follower"}),followers:t(nt,{relationName:"creator"}),likes:t(ni),comments:t(ns)})),nr=st(s3,({one:e,many:t})=>({creator:e(s9,{fields:[s3.creatorId],references:[s9.id]}),media:t(s4),paymentIntents:t(s7),entitlements:t(ne),likes:t(ni),comments:t(ns)})),na=st(ne,({one:e})=>({user:e(s9,{fields:[ne.userId],references:[s9.id]}),content:e(s3,{fields:[ne.contentId],references:[s3.id]}),paymentIntent:e(s7,{fields:[ne.paymentIntentId],references:[s7.id]})})),no=st(nt,({one:e})=>({follower:e(s9,{fields:[nt.followerId],references:[s9.id],relationName:"follower"}),creator:e(s9,{fields:[nt.creatorId],references:[s9.id],relationName:"creator"})})),nl=st(ni,({one:e})=>({user:e(s9,{fields:[ni.userId],references:[s9.id]}),content:e(s3,{fields:[ni.contentId],references:[s3.id]})})),nu=st(ns,({one:e})=>({user:e(s9,{fields:[ns.userId],references:[s9.id]}),content:e(s3,{fields:[ns.contentId],references:[s3.id]})})),nc=st(s4,({one:e})=>({content:e(s3,{fields:[s4.contentId],references:[s3.id]})})),nh=st(s6,({one:e})=>({profile:e(s9,{fields:[s6.profileId],references:[s9.id]})})),nd=st(s7,({one:e})=>({user:e(s9,{fields:[s7.userId],references:[s9.id]}),content:e(s3,{fields:[s7.contentId],references:[s3.id]})}));e.s(["comments",0,ns,"commentsRelations",0,nu,"content",0,s3,"contentMedia",0,s4,"contentMediaRelations",0,nc,"contentRelations",0,nr,"contentStatusEnum",0,s2,"contentTypeEnum",0,s8,"creatorProfiles",0,s6,"creatorProfilesRelations",0,nh,"entitlements",0,ne,"entitlementsRelations",0,na,"follows",0,nt,"followsRelations",0,no,"likes",0,ni,"likesRelations",0,nl,"paymentIntents",0,s7,"paymentIntentsRelations",0,nd,"paymentStatusEnum",0,s5,"profiles",0,s9,"profilesRelations",0,nn,"userRoleEnum",0,s1],18916);var nf=e.i(18916);if(!process.env.DATABASE_URL)throw Error("DATABASE_URL environment variable is not set");let ng=s0((0,n.neon)(process.env.DATABASE_URL),{schema:nf});e.s(["db",0,ng],79371)}];

//# sourceMappingURL=src_db_index_ts_a71f50f0._.js.map