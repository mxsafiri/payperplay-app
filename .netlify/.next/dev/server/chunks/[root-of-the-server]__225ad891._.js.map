{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/victormuhagachi/CascadeProjects/payperplay-starter/src/db/schema.ts"],"sourcesContent":["import { pgTable, text, timestamp, integer, boolean, pgEnum, uuid, decimal, index } from 'drizzle-orm/pg-core';\nimport { relations } from 'drizzle-orm';\n\n// Enums\nexport const userRoleEnum = pgEnum('user_role', ['creator', 'fan']);\nexport const contentStatusEnum = pgEnum('content_status', ['draft', 'published', 'archived']);\nexport const contentTypeEnum = pgEnum('content_type', ['youtube_preview', 'upload']);\nexport const paymentStatusEnum = pgEnum('payment_status', ['pending', 'paid', 'failed', 'refunded']);\n\n// Profiles table (extends neon_auth.user)\nexport const profiles = pgTable('profiles', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  userId: text('user_id').notNull().unique(), // References neon_auth.user.id\n  role: userRoleEnum('role').notNull().default('fan'),\n  handle: text('handle').notNull().unique(),\n  displayName: text('display_name'),\n  bio: text('bio'),\n  avatarUrl: text('avatar_url'),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  updatedAt: timestamp('updated_at').defaultNow().notNull(),\n}, (table) => ({\n  handleIdx: index('profiles_handle_idx').on(table.handle),\n  userIdIdx: index('profiles_user_id_idx').on(table.userId),\n}));\n\n// Creator profiles (additional info for creators)\nexport const creatorProfiles = pgTable('creator_profiles', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  profileId: uuid('profile_id').notNull().references(() => profiles.id, { onDelete: 'cascade' }),\n  verificationStatus: text('verification_status').default('unverified'), // unverified, pending, verified\n  payoutPhone: text('payout_phone'), // Mobile money number for payouts\n  totalEarnings: decimal('total_earnings', { precision: 12, scale: 2 }).default('0'),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  updatedAt: timestamp('updated_at').defaultNow().notNull(),\n}, (table) => ({\n  profileIdIdx: index('creator_profiles_profile_id_idx').on(table.profileId),\n}));\n\n// Content table\nexport const content = pgTable('content', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  creatorId: uuid('creator_id').notNull().references(() => profiles.id, { onDelete: 'cascade' }),\n  title: text('title').notNull(),\n  description: text('description'),\n  category: text('category').notNull(), // music, comedy, education, etc.\n  status: contentStatusEnum('status').notNull().default('draft'),\n  contentType: contentTypeEnum('content_type').notNull(),\n  priceTzs: integer('price_tzs').notNull(), // Price in Tanzanian Shillings\n  viewCount: integer('view_count').default(0),\n  likeCount: integer('like_count').default(0),\n  commentCount: integer('comment_count').default(0),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  updatedAt: timestamp('updated_at').defaultNow().notNull(),\n  publishedAt: timestamp('published_at'),\n}, (table) => ({\n  creatorIdIdx: index('content_creator_id_idx').on(table.creatorId),\n  statusIdx: index('content_status_idx').on(table.status),\n  categoryIdx: index('content_category_idx').on(table.category),\n  publishedAtIdx: index('content_published_at_idx').on(table.publishedAt),\n}));\n\n// Content media (YouTube URLs or upload storage keys)\nexport const contentMedia = pgTable('content_media', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  contentId: uuid('content_id').notNull().references(() => content.id, { onDelete: 'cascade' }),\n  mediaType: text('media_type').notNull(), // 'youtube', 'video', 'thumbnail'\n  url: text('url'), // YouTube URL or CDN URL\n  storageKey: text('storage_key'), // For uploaded files (S3/R2 key)\n  duration: integer('duration'), // Video duration in seconds\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n}, (table) => ({\n  contentIdIdx: index('content_media_content_id_idx').on(table.contentId),\n}));\n\n// Payment intents (tracks payment flow)\nexport const paymentIntents = pgTable('payment_intents', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  userId: uuid('user_id').notNull().references(() => profiles.id, { onDelete: 'cascade' }),\n  contentId: uuid('content_id').notNull().references(() => content.id, { onDelete: 'cascade' }),\n  amountTzs: integer('amount_tzs').notNull(),\n  status: paymentStatusEnum('status').notNull().default('pending'),\n  provider: text('provider'), // 'selcom', 'dpo', 'flutterwave', etc.\n  providerReference: text('provider_reference'), // External payment reference\n  phoneNumber: text('phone_number'), // User's mobile money number\n  metadata: text('metadata'), // JSON string for additional data\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  updatedAt: timestamp('updated_at').defaultNow().notNull(),\n  paidAt: timestamp('paid_at'),\n}, (table) => ({\n  userIdIdx: index('payment_intents_user_id_idx').on(table.userId),\n  contentIdIdx: index('payment_intents_content_id_idx').on(table.contentId),\n  statusIdx: index('payment_intents_status_idx').on(table.status),\n  providerRefIdx: index('payment_intents_provider_ref_idx').on(table.providerReference),\n}));\n\n// Entitlements (access grants after payment)\nexport const entitlements = pgTable('entitlements', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  userId: uuid('user_id').notNull().references(() => profiles.id, { onDelete: 'cascade' }),\n  contentId: uuid('content_id').notNull().references(() => content.id, { onDelete: 'cascade' }),\n  paymentIntentId: uuid('payment_intent_id').references(() => paymentIntents.id),\n  grantedAt: timestamp('granted_at').defaultNow().notNull(),\n}, (table) => ({\n  userContentIdx: index('entitlements_user_content_idx').on(table.userId, table.contentId),\n  contentIdIdx: index('entitlements_content_id_idx').on(table.contentId),\n}));\n\n// Follows (fan follows creator)\nexport const follows = pgTable('follows', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  followerId: uuid('follower_id').notNull().references(() => profiles.id, { onDelete: 'cascade' }),\n  creatorId: uuid('creator_id').notNull().references(() => profiles.id, { onDelete: 'cascade' }),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n}, (table) => ({\n  followerCreatorIdx: index('follows_follower_creator_idx').on(table.followerId, table.creatorId),\n}));\n\n// Likes\nexport const likes = pgTable('likes', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  userId: uuid('user_id').notNull().references(() => profiles.id, { onDelete: 'cascade' }),\n  contentId: uuid('content_id').notNull().references(() => content.id, { onDelete: 'cascade' }),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n}, (table) => ({\n  userContentIdx: index('likes_user_content_idx').on(table.userId, table.contentId),\n}));\n\n// Comments\nexport const comments = pgTable('comments', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  userId: uuid('user_id').notNull().references(() => profiles.id, { onDelete: 'cascade' }),\n  contentId: uuid('content_id').notNull().references(() => content.id, { onDelete: 'cascade' }),\n  body: text('body').notNull(),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  updatedAt: timestamp('updated_at').defaultNow().notNull(),\n}, (table) => ({\n  contentIdIdx: index('comments_content_id_idx').on(table.contentId),\n  createdAtIdx: index('comments_created_at_idx').on(table.createdAt),\n}));\n\n// Relations\nexport const profilesRelations = relations(profiles, ({ one, many }) => ({\n  creatorProfile: one(creatorProfiles, {\n    fields: [profiles.id],\n    references: [creatorProfiles.profileId],\n  }),\n  content: many(content),\n  paymentIntents: many(paymentIntents),\n  entitlements: many(entitlements),\n  following: many(follows, { relationName: 'follower' }),\n  followers: many(follows, { relationName: 'creator' }),\n  likes: many(likes),\n  comments: many(comments),\n}));\n\nexport const contentRelations = relations(content, ({ one, many }) => ({\n  creator: one(profiles, {\n    fields: [content.creatorId],\n    references: [profiles.id],\n  }),\n  media: many(contentMedia),\n  paymentIntents: many(paymentIntents),\n  entitlements: many(entitlements),\n  likes: many(likes),\n  comments: many(comments),\n}));\n\nexport const entitlementsRelations = relations(entitlements, ({ one }) => ({\n  user: one(profiles, {\n    fields: [entitlements.userId],\n    references: [profiles.id],\n  }),\n  content: one(content, {\n    fields: [entitlements.contentId],\n    references: [content.id],\n  }),\n  paymentIntent: one(paymentIntents, {\n    fields: [entitlements.paymentIntentId],\n    references: [paymentIntents.id],\n  }),\n}));\n\nexport const followsRelations = relations(follows, ({ one }) => ({\n  follower: one(profiles, {\n    fields: [follows.followerId],\n    references: [profiles.id],\n    relationName: 'follower',\n  }),\n  creator: one(profiles, {\n    fields: [follows.creatorId],\n    references: [profiles.id],\n    relationName: 'creator',\n  }),\n}));\n\nexport const likesRelations = relations(likes, ({ one }) => ({\n  user: one(profiles, {\n    fields: [likes.userId],\n    references: [profiles.id],\n  }),\n  content: one(content, {\n    fields: [likes.contentId],\n    references: [content.id],\n  }),\n}));\n\nexport const commentsRelations = relations(comments, ({ one }) => ({\n  user: one(profiles, {\n    fields: [comments.userId],\n    references: [profiles.id],\n  }),\n  content: one(content, {\n    fields: [comments.contentId],\n    references: [content.id],\n  }),\n}));\n\nexport const contentMediaRelations = relations(contentMedia, ({ one }) => ({\n  content: one(content, {\n    fields: [contentMedia.contentId],\n    references: [content.id],\n  }),\n}));\n\nexport const creatorProfilesRelations = relations(creatorProfiles, ({ one }) => ({\n  profile: one(profiles, {\n    fields: [creatorProfiles.profileId],\n    references: [profiles.id],\n  }),\n}));\n\nexport const paymentIntentsRelations = relations(paymentIntents, ({ one }) => ({\n  user: one(profiles, {\n    fields: [paymentIntents.userId],\n    references: [profiles.id],\n  }),\n  content: one(content, {\n    fields: [paymentIntents.contentId],\n    references: [content.id],\n  }),\n}));\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 424, "column": 0}, "map": {"version":3,"sources":["file:///Users/victormuhagachi/CascadeProjects/payperplay-starter/src/db/index.ts"],"sourcesContent":["import { drizzle } from 'drizzle-orm/neon-http';\nimport { neon } from '@neondatabase/serverless';\nimport * as schema from './schema';\n\nif (!process.env.DATABASE_URL) {\n  throw new Error('DATABASE_URL environment variable is not set');\n}\n\nconst sql = neon(process.env.DATABASE_URL);\nexport const db = drizzle(sql, { schema });\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAC7B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAM,IAAA,gKAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;AAClC,MAAM,KAAK,IAAA,qKAAO,EAAC,KAAK;IAAE,QAAA;AAAO"}},
    {"offset": {"line": 445, "column": 0}, "map": {"version":3,"sources":["file:///Users/victormuhagachi/CascadeProjects/payperplay-starter/src/lib/auth.ts"],"sourcesContent":["import { betterAuth } from \"better-auth\";\nimport { Pool } from \"@neondatabase/serverless\";\n\nexport const auth = betterAuth({\n  baseURL: process.env.NEXT_PUBLIC_APP_URL || \"http://localhost:3000\",\n  database: new Pool({ connectionString: process.env.DATABASE_URL }),\n  emailAndPassword: {\n    enabled: true,\n  },\n  socialProviders: {\n    google: {\n      clientId: process.env.GOOGLE_CLIENT_ID || \"\",\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"\",\n      enabled: !!process.env.GOOGLE_CLIENT_ID,\n    },\n    github: {\n      clientId: process.env.GITHUB_CLIENT_ID || \"\",\n      clientSecret: process.env.GITHUB_CLIENT_SECRET || \"\",\n      enabled: !!process.env.GITHUB_CLIENT_ID,\n    },\n  },\n  advanced: {\n    useSecureCookies: process.env.NODE_ENV === \"production\",\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,MAAM,OAAO,IAAA,uKAAU,EAAC;IAC7B,SAAS,6DAAmC;IAC5C,UAAU,IAAI,gKAAI,CAAC;QAAE,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAAC;IAChE,kBAAkB;QAChB,SAAS;IACX;IACA,iBAAiB;QACf,QAAQ;YACN,UAAU,QAAQ,GAAG,CAAC,gBAAgB,IAAI;YAC1C,cAAc,QAAQ,GAAG,CAAC,oBAAoB,IAAI;YAClD,SAAS,CAAC,CAAC,QAAQ,GAAG,CAAC,gBAAgB;QACzC;QACA,QAAQ;YACN,UAAU,QAAQ,GAAG,CAAC,gBAAgB,IAAI;YAC1C,cAAc,QAAQ,GAAG,CAAC,oBAAoB,IAAI;YAClD,SAAS,CAAC,CAAC,QAAQ,GAAG,CAAC,gBAAgB;QACzC;IACF;IACA,UAAU;QACR,kBAAkB,oDAAyB;IAC7C;AACF"}},
    {"offset": {"line": 482, "column": 0}, "map": {"version":3,"sources":["file:///Users/victormuhagachi/CascadeProjects/payperplay-starter/src/app/api/content/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { db } from \"@/db\";\nimport { content } from \"@/db/schema\";\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { eq } from \"drizzle-orm\";\n\nexport async function GET(\n  req: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n\n    // Get content with creator and media\n    const contentItem = await db.query.content.findFirst({\n      where: eq(content.id, id),\n      with: {\n        creator: {\n          columns: {\n            id: true,\n            handle: true,\n            displayName: true,\n            avatarUrl: true,\n          },\n        },\n        media: {\n          columns: {\n            id: true,\n            mediaType: true,\n            url: true,\n          },\n        },\n      },\n    });\n\n    if (!contentItem) {\n      return NextResponse.json(\n        { error: \"Content not found\" },\n        { status: 404 }\n      );\n    }\n\n    // Check if user has access\n    let hasAccess = false;\n    const session = await auth.api.getSession({\n      headers: await headers(),\n    });\n\n    if (session) {\n      const profile = await db.query.profiles.findFirst({\n        where: (profiles, { eq }) => eq(profiles.userId, session.user.id),\n      });\n\n      if (profile) {\n        // Check if user is the creator\n        if (profile.id === contentItem.creatorId) {\n          hasAccess = true;\n        } else {\n          // Check for entitlement\n          const entitlement = await db.query.entitlements.findFirst({\n            where: (entitlements, { and, eq }) =>\n              and(\n                eq(entitlements.userId, profile.id),\n                eq(entitlements.contentId, id)\n              ),\n          });\n          hasAccess = !!entitlement;\n        }\n      }\n    }\n\n    return NextResponse.json({\n      ...contentItem,\n      hasAccess,\n    });\n  } catch (error) {\n    console.error(\"Content detail fetch error:\", error);\n    return NextResponse.json(\n      { error: \"Failed to fetch content\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAEO,eAAe,IACpB,GAAgB,EAChB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QAErB,qCAAqC;QACrC,MAAM,cAAc,MAAM,0HAAE,CAAC,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC;YACnD,OAAO,IAAA,0KAAE,EAAC,gIAAO,CAAC,EAAE,EAAE;YACtB,MAAM;gBACJ,SAAS;oBACP,SAAS;wBACP,IAAI;wBACJ,QAAQ;wBACR,aAAa;wBACb,WAAW;oBACb;gBACF;gBACA,OAAO;oBACL,SAAS;wBACP,IAAI;wBACJ,WAAW;wBACX,KAAK;oBACP;gBACF;YACF;QACF;QAEA,IAAI,CAAC,aAAa;YAChB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAoB,GAC7B;gBAAE,QAAQ;YAAI;QAElB;QAEA,2BAA2B;QAC3B,IAAI,YAAY;QAChB,MAAM,UAAU,MAAM,4HAAI,CAAC,GAAG,CAAC,UAAU,CAAC;YACxC,SAAS,MAAM,IAAA,4IAAO;QACxB;QAEA,IAAI,SAAS;YACX,MAAM,UAAU,MAAM,0HAAE,CAAC,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC;gBAChD,OAAO,CAAC,UAAU,EAAE,EAAE,EAAE,GAAK,GAAG,SAAS,MAAM,EAAE,QAAQ,IAAI,CAAC,EAAE;YAClE;YAEA,IAAI,SAAS;gBACX,+BAA+B;gBAC/B,IAAI,QAAQ,EAAE,KAAK,YAAY,SAAS,EAAE;oBACxC,YAAY;gBACd,OAAO;oBACL,wBAAwB;oBACxB,MAAM,cAAc,MAAM,0HAAE,CAAC,KAAK,CAAC,YAAY,CAAC,SAAS,CAAC;wBACxD,OAAO,CAAC,cAAc,EAAE,GAAG,EAAE,EAAE,EAAE,GAC/B,IACE,GAAG,aAAa,MAAM,EAAE,QAAQ,EAAE,GAClC,GAAG,aAAa,SAAS,EAAE;oBAEjC;oBACA,YAAY,CAAC,CAAC;gBAChB;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,GAAG,WAAW;YACd;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA0B,GACnC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}